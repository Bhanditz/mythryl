## log.pkg
#
# This is a low-level kludge to get around cyclic package dependencies when
# doing logging from low-level code like src/lib/std/src/posix/winix-process.pkg
# where log::note and logger::log_if cannot be used.

# Compiled by:
#     src/lib/std/src/standard-core.sublib

package log {
    #
    log_note__hook  =  REF  (NULL:  Null_Or( (Void -> String) -> Void ));		# This gets set at the bottom of	src/lib/std/src/io/winix-text-file-for-os-g.pkg
    log_warn__hook  =  REF  (NULL:  Null_Or( (Void -> String) -> Void ));		# This gets set at the bottom of	src/lib/std/src/io/winix-text-file-for-os-g.pkg
    log_fatal__hook =  REF  (NULL:  Null_Or( (Void -> String) -> Void ));		# This gets set at the bottom of	src/lib/std/src/io/winix-text-file-for-os-g.pkg

    fun note (msg_maker: Void -> String)
	=
	case *log_note__hook
	    #
	    THE file_note =>  file_note  msg_maker;					# file_note will be file::note().			file	is from   src/lib/std/src/posix/file.pkg
	    #
	    NULL          =>  ();							# Drop msg on the floor.  We could buffer them, but that might well do more harm than good.
	esac;										# Also, we take advantage of this to shut off log::note during system shutdown, when evaluating

    fun warn (msg_maker: Void -> String)
	=
	case *log_warn__hook
	    #
	    THE file_warn =>  file_warn  msg_maker;					# file_warn will be file::warn().			file	is from   src/lib/std/src/posix/file.pkg
	    #
	    NULL          =>  ();							# Drop msg on the floor.  We could buffer them, but that might well do more harm than good.
	esac;										# Also, we take advantage of this to shut off log::note during system shutdown, when evaluating

    fun fatal (msg_maker: Void -> String)						# DOES NOT RETURN.
	=
	case *log_fatal__hook
	    #
	    THE file_fatal =>  file_fatal  msg_maker;					# file_fatal will be file::fatal().			file	is from   src/lib/std/src/posix/file.pkg
	    #
	    NULL           =>  ();							# Drop msg on the floor.  We could buffer them, but that might well do more harm than good.
	esac;										# Also, we take advantage of this to shut off log::note during system shutdown, when evaluating
};											# msg_maker() might crash us due to disabled resources in a no-longer-fully-functional image.