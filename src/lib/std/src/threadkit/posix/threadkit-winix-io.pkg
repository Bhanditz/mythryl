## threadkit-winix-io.pkg

# Compiled by:
#     src/lib/std/standard.lib



###              "They are ill discoverers that
###               think there is no land, when
###               they can see nothing but sea."
###
###                          -- Francis Bacon



stipulate
    package ioq =  io_mailop;							# io_mailop			is from   src/lib/src/lib/thread-kit/src/core-thread-kit/io-mailop.pkg
    package wnx =  winix;							# winix				is from   src/lib/std/winix.pkg
    package wio =  winix::io;							# winix_io			is from   src/lib/std/src/posix/winix-io.pkg
    package wty =  winix_types;							# winix_types			is from   src/lib/std/src/posix/winix-types.pkg
herein

    package   threadkit_winix_io
    : (weak)  Threadkit_Winix_Io						# Threadkit_Winix_Io		is from   src/lib/src/lib/thread-kit/src/winix/threadkit-winix-io.api
    {
	Iod      =  wio::Iod;
	Iod_Kind == wty::Iod_Kind;

	hash           =  wio::hash;
	compare        =  wio::compare;
	iod_to_iodkind =  wio::iod_to_iodkind;


	Ioplea =  wio::Ioplea;
	Ioplea_Result  =  wio::Ioplea_Result;

	exception BAD_WAIT_REQUEST = wio::BAD_WAIT_REQUEST;

	# Polling functions 
	#
	stipulate

	    include threadkit;							# threadkit			is from   src/lib/src/lib/thread-kit/src/core-thread-kit/threadkit.pkg

	    fun timeout''  duration
		=
		timeout_in'  duration
		    ==>
		    .{ []; };

	    fun make_io_mailop  pd
		=
		ioq::make_io_mailop  pd
		    ==>
		    (fn info =  [ info ]);

	herein

	    fun wait_for_io_opportunity_mailop [pd] =>  make_io_mailop pd;
		wait_for_io_opportunity_mailop _    =>  raise exception FAIL "ioq::winix::wait_for_io_opportunity_mailop not fully implemented";	# XXX SUCKO FIXME
	    end;

	    fun wait_for_io_opportunity ([pd], NULL)  =>  do_mailop (make_io_mailop pd);
		wait_for_io_opportunity ([pd], THE t) =>  select [timeout'' t, make_io_mailop pd];
		wait_for_io_opportunity _             =>  raise exception FAIL "ioq::winix::poll not fully implemented";				# XXX SUCKO FIXME
	    end;

	    # Deprecated synonyms for above, mainly so that unix
	    # folks looking for 'select' in the function index
	    # will get led here:
	    #	 
	    select        =  wait_for_io_opportunity;
	    select_mailop =  wait_for_io_opportunity_mailop;
	end;
    };
end;

## COPYRIGHT (c) 1995 AT&T Bell Laboratories.
## Subsequent changes by Jeff Prothero Copyright (c) 2010-2012,
## released under Gnu Public Licence version 3.
