## winix-io.api

# Compiled by:
#     src/lib/std/src/standard-core.sublib



# A sub-api of api Winix:
#
#     src/lib/std/src/winix/winix.api

# This api is implemented in:
#
#     src/lib/std/src/posix/winix-io.pkg
#
api Winix_Io {
    #
    eqtype Iod;
	#
	# An Iod is an abstract descriptor
        # for an OS entity that supports I/O
        # (e::g., file, tty device, socket, ...).

    eqtype Iod_Kind;

    hash:  Iod -> Unt;				# Return a hash value for the I/O descriptor. 

    compare:  (Iod, Iod) -> Order;		# Compare two I/O descriptors 

    iod_to_iodkind:  Iod -> Iod_Kind;	# Return the kind of I/O descriptor: FILE|DIR|SYMLINK|TTY|PIPE|SOCKET|DEVICE|OTHER.
								# Existing code uses this only to check for TTY, mostly to select line-buffering vs block buffering.
    package kind
	:
	api {
	    file:     Iod_Kind;
	    dir:      Iod_Kind; 
	    symlink:  Iod_Kind; 
	    tty:      Iod_Kind; 
	    pipe:     Iod_Kind; 
	    socket:   Iod_Kind; 
	    device:   Iod_Kind; 
	};

    Wait_Request
	=
        { io_descriptor:    Iod,
          readable:	    Bool,
          writable:	    Bool,
          oobdable:	    Bool				# Out-Of-Band-Data available on socket or PTY.
        };
	# Public representation of a polling operation on
	# an I/O descriptor.

    Wait_Result	= Wait_Request;					# A synonym to clarify declarations.

    exception BAD_WAIT_REQUEST;

    # Block on a set of I/O descriptors until
    # an I/O opportunity arises or until
    # specified timeout expires.
    #
    # See also the 'wait_for_io_opportunity' operation in:   src/lib/std/src/socket/socket.api
    #
    wait_for_io_opportunity
      :
      { wait_requests:	List( Wait_Request ),
	timeout:	Null_Or( time::Time )			# Timeout: NULL means wait forever, (THE time::zero_time) means do not block.
      }
      ->
      List( Wait_Result );

    # Deprecated synonym for above, mainly so that unix folks
    # looking for 'select' in the function index will get led here:
    #
    select
      :
      { wait_requests:	List( Wait_Request ),
	timeout:	Null_Or( time::Time )
      }
      ->
      List( Wait_Result );

};								# api Winix_Io 




## COPYRIGHT (c) 1995 AT&T Bell Laboratories.
## Subsequent changes by Jeff Prothero Copyright (c) 2010-2012,
## released under Gnu Public Licence version 3.
