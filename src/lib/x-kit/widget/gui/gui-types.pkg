## gui-types.pkg
#
# Types common to
#     src/lib/x-kit/widget/gui/stopped-gui.pkg
#     src/lib/x-kit/widget/gui/running-gui.pkg 

# Compiled by:
#     src/lib/x-kit/widget/xkit-widget.sublib


stipulate
    include package   threadkit;							# threadkit				is from   src/lib/src/lib/thread-kit/src/core-thread-kit/threadkit.pkg
    #

    package w2g =  gadget_to_guiboss;							# gadget_to_guiboss			is from   src/lib/x-kit/widget/gui/gadget-to-guiboss.pkg
    package b2g =  guiboss_to_gadget;							# guiboss_to_gadget			is from   src/lib/x-kit/widget/gui/guiboss-to-gadget.pkg

    package w2p =  widget_to_packedspace;						# widget_to_packedspace			is from   src/lib/x-kit/widget/space/packed/widget-to-packedspace.pkg   
    package p2w =  packedspace_to_widget;						# packedspace_to_widget			is from   src/lib/x-kit/widget/space/packed/packedspace-to-widget.pkg

    package o2c =  object_to_canvasspace;						# object_to_canvasspace			is from   src/lib/x-kit/widget/space/canvas/object-to-canvasspace.pkg   
    package c2o =  canvasspace_to_object;						# canvasspace_to_object			is from   src/lib/x-kit/widget/space/canvas/canvasspace-to-object.pkg

    package s2b =  sprite_to_bouncespace;						# sprite_to_bouncespace			is from   src/lib/x-kit/widget/space/bounce/sprite-to-bouncespace.pkg   
    package b2s =  bouncespace_to_sprite;						# bouncespace_to_sprite			is from   src/lib/x-kit/widget/space/bounce/bouncespace-to-sprite.pkg
herein

    package gui_types
    {
											# Can't define a Widget_Imports here because of the type recursion on endstate_oneshot.
	Widget_Exports
	  =
	  { guiboss_to_gadget:		b2g::Guiboss_To_Gadget,				# 
	    packedspace_to_widget:	p2w::Packedspace_To_Widget			# 
	  };

	Packed_Widget_Start_Fn
	  =
	  PACKED_WIDGET_START_FN							# Needs to be a datatype (vs plain type) because of the recursive reference in endstate_oneshot.
	    (
	      { gadget_to_guiboss:	w2g::Gadget_To_Guiboss,				# 
		widget_to_packedspace:	w2p::Widget_To_Packedspace,			# 
		run_gun':		Run_Gun,					#
		end_gun':		End_Gun,					#
		endstate_oneshot:	Oneshot_Maildrop( ( Packed_Widget_Start_Fn,
							    Null_Or(Exception)		# saved_widget_state value used by arrowbutton etc to preserve state across gui stop/restart cycles.
							) ),				#
		saved_widget_state:	Null_Or(Exception)				# When restarting a stopped gui this preserves the local state for (e.g.) arrowbutton.
	      }										# arrowbutton				is from   src/lib/x-kit/widget/leaf/arrowbutton.pkg
	      ->
	      Widget_Exports	
	    );




	Object_Exports
	  =
	  { guiboss_to_gadget:		b2g::Guiboss_To_Gadget,				# 
	    canvasspace_to_object:	c2o::Canvasspace_To_Object			# 
	  };

	Canvas_Object_Start_Fn
	  =
	  CANVAS_OBJECT_START_FN							# Needs to be a datatype (vs plain type) because of the recursive reference in endstate_oneshot.
	    (
	      { gadget_to_guiboss:	w2g::Gadget_To_Guiboss,				# 
		object_to_canvasspace:	o2c::Object_To_Canvasspace,			# 
		run_gun':		Run_Gun,					#
		end_gun':		End_Gun,					#
		endstate_oneshot:	Oneshot_Maildrop( Canvas_Object_Start_Fn ),	#
		saved_object_state:	Null_Or(Exception)				# When restarting a stopped gui this preserves the local state for (e.g.) arrowbutton.
	      }
	      ->
	      Object_Exports	
	    );





	Sprite_Exports
	  =
	  { guiboss_to_gadget:		b2g::Guiboss_To_Gadget,				# 
	    bouncespace_to_sprite:	b2s::Bouncespace_To_Sprite			# 
	  };

	Bounce_Sprite_Start_Fn
	  =
	  BOUNCE_SPRITE_START_FN							# Needs to be a datatype (vs plain type) because of the recursive reference in endstate_oneshot.
	    (
	      { gadget_to_guiboss:	w2g::Gadget_To_Guiboss,				# 
		sprite_to_bouncespace:	s2b::Sprite_To_Bouncespace,			# 
		run_gun':		Run_Gun,					#
		end_gun':		End_Gun,					#
		endstate_oneshot:	Oneshot_Maildrop( Bounce_Sprite_Start_Fn ),	#
		saved_sprite_state:	Null_Or(Exception)				# When restarting a stopped gui this preserves the local state for (e.g.) arrowbutton.
	      }
	      ->
	      Sprite_Exports	
	    );
    };
end;

