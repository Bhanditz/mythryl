# Makefile.in
#
# The makefile for the "pthread" (multicore) support library
#
# This makefile is/wouldbe invoked by the rule
#
#    $(CLIB_DIR)/pthread/libmythryl-pthread.a:  sizes-of-some-c-types--autogenerated.h system-signals.h
#	    (cd $(CLIB_DIR)/pthread; $(MAKE)  $(LIB_MK_ARGS) libmythryl-pthread.a)
#
# in
#
#     src/c/o/Makefile
#
# which derives from
#
#     src/c/o/Makefile.in
#
#

MAKE =		make
AR =		ar
ARFLAGS =	rcv
RANLIB =	ranlib

VERSION =	v-dummy

LIB =		libmythryl-pthread.a

INC_DIR =	../h
INCLUDES =	-I$(INC_DIR)


# Each version of the multicore-support library has its own list of .o files:
#
SGI_OBJS	    =	pthread-on-sgi.o
POSIX_THREADS_OBJS  =	pthread-on-posix-threads.o



$(LIB) :	$(VERSION) $(OBJS)
	@rm -rf $(LIB)
	$(AR) $(ARFLAGS) $(LIB) $(OBJS)
	$(RANLIB) $(LIB)

$(VERSION) :
	echo "$(VERSION)" > $(VERSION)

pthread-on-sgi.o:	pthread-on-sgi.c \
		$(INC_DIR)/runtime-base.h $(INC_DIR)/runtime-configuration.h \
		$(INC_DIR)/runtime-values.h $(INC_DIR)/heap-tags.h $(INC_DIR)/runtime-pthread.h \
		$(INC_DIR)/task.h $(INC_DIR)/runtime-globals.h
	$(CC) -c $(CFLAGS) $(DEFS) $(INCLUDES) pthread-on-sgi.c

pthread-on-posix-threads.o:	pthread-on-posix-threads.c \
		$(INC_DIR)/runtime-base.h $(INC_DIR)/runtime-configuration.h \
		$(INC_DIR)/runtime-values.h $(INC_DIR)/heap-tags.h $(INC_DIR)/runtime-pthread.h \
		$(INC_DIR)/task.h $(INC_DIR)/runtime-globals.h
	$(CC) -c $(CFLAGS) $(DEFS) $(INCLUDES) pthread-on-posix-threads.c

clean :
	@rm -f v-* *.o $(LIB)
