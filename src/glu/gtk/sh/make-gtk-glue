#!/usr/bin/mythryl

# To minimize code redundancy and consequent
# reliability and maintenance headaches in
#
#     src/glu/gtk/c/in-sub/mythryl-gtk-library-in-c-subprocess.c
#
# we synthesize simple repetitive functions
# directly from their
#
#     src/glu/gtk/src/gtk-client.api
#
# type declarations.
#
# The specifications for these functions and
# related declarations and docs are in
#
#     src/glu/gtk/etc/library-glue.plan
#
# (See top-of-file comments there.)
#
# We are invoked by doing
# 
#     make gtk-glue
#
# At the top level.  This is not done as part
# of a normal build;  I run it by hand after
# I've updated (say) library-glue.plan

stipulate
    package fil =  file__premicrothread;												# file__premicrothread		is from   src/lib/std/src/posix/file--premicrothread.pkg
    package lms =  list_mergesort;													# list_mergesort		is from   src/lib/src/list-mergesort.pkg
    package iow =  io_wait_hostthread;													# io_wait_hostthread		is from   src/lib/std/src/hostthread/io-wait-hostthread.pkg
    package mlb =  make_library_binding;												# make_library_binding		is from   src/lib/make-library-glue/make-library-glue.pkg
herein

{    
# iow::test "make-gtk-glue: testt/AAA";



    mlb::make_library_binding
	{
	  lib_name						=>  "gtk",								# Must match the   #define CLIB_NAME "gtk"   line in   src/glu/gtk/c/in-main/libmythryl-gtk.c
	  library_binding_specification				=>  "src/glu/gtk/etc/library-glue.plan",
	  xxx_client_api					=>  "src/glu/gtk/src/gtk-client.api",
	  xxx_client_g_pkg					=>  "src/glu/gtk/src/gtk-client-g.pkg",
	  xxx_client_driver_api					=>  "src/glu/gtk/src/gtk-client-driver.api",
	  xxx_client_driver_for_library_in_c_subprocess_pkg	=>  "src/glu/gtk/src/gtk-client-driver-for-library-in-c-subprocess.pkg",
	  xxx_client_driver_for_library_in_main_process_pkg	=>  "src/glu/gtk/src/gtk-client-driver-for-library-in-main-process.pkg",
	  mythryl_xxx_library_in_c_subprocess_c			=>  "src/glu/gtk/c/in-sub/mythryl-gtk-library-in-c-subprocess.c",
	  libmythryl_xxx_c					=>  "src/glu/gtk/c/in-main/libmythryl-gtk.c",
	  section_libref_xxx_tex				=>  "src/glu/gtk/doc/tex/section-libref-gtk.tex"
	}
	[																# Plugins that extend base mlb functionality.
	  mlb::LIBCALL_TO_ARGS_FN  libcall_to_args_fn
	]
	where
	    fun libcall_to_args_fn  libcall
		=
		# libcall contains embedded arguments like w0, i1, f2, b3, s4.
		#
		# The argument letter gives us the argument type:
		#
		#    w == widget
		#    i == int
		#    f == double  (Mythryl "Float")
		#    b == bool
		#    s == string
		#
		# The argument digit gives us the argument order:
		#
		#    0 == first arg
		#    1 == second arg
		#    ...
		#
		# Get list of above args, sorting by
		# trailing digit and dropping duplicates.
		#
		# Our implementation here differs from the
		# default implementation in 
		#
		#     src/lib/make-library-glue/make-library-glue.pkg
		#
		# only by adding support for 'w' ("widget"):
		#
		{    raw_list    =  regex::find_all  ./\b[bfisw][0-9]\b/  libcall;
		    #
		    cooked_list =  uniquesort  compare_fn  raw_list;

		    cooked_list;
		}
		where	
		    fun compare_fn (xn, yn)					# Compare "w0" and "b1" as "0" and "1":
			=
			{   xn' = string::extract (xn, 1, NULL);
			    yn' = string::extract (yn, 1, NULL);

			    string::compare (xn', yn');
			};
		end;        
	end;

    exit_x(0);
};
end;


##########################################################################
#   The following is support for outline-minor-mode in emacs.		 #
#  ^C @ ^T hides all Text. (Leaves all headings.)			 #
#  ^C @ ^A shows All of file.						 #
#  ^C @ ^Q Quickfolds entire file. (Leaves only top-level headings.)	 #
#  ^C @ ^I shows Immediate children of node.				 #
#  ^C @ ^S Shows all of a node.						 #
#  ^C @ ^D hiDes all of a node.						 #
#  ^HFoutline-mode gives more details.					 #
#  (Or do ^HI and read emacs:outline mode.)				 #
#									 #
# Local variables:							 #
# mode: outline-minor							 #
# outline-regexp: "[{ \t]*\\(fun \\)"			 		 #
# End:									 #
##########################################################################



## Code by Jeff Prothero: Copyright (c) 2010-2012,
## released under Gnu Public Licence version 3.
