<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>Mythryl printf</TITLE>
</HEAD>
<BODY >
<A HREF="my-SML_vs_Mythryl.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Mythryl_for_SML_Programmers.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-Non-Syntactic_Differences.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc184">5.7.2</A>  Mythryl printf</H3><P><I>(We discuss</I> <TT>printf</TT> <I>early due to its frequent use in examples.)</I></P><P>There have been a number of attempts to match the conciseness and 
convenience of the C <TT>printf()</TT> function in the SML setting. 
All of them suffer by comparison.</P><P>The core problem is that C is taking advantage of the type information 
implicit in the format string, whereas the SML solutions all wind 
up replicating that type information in the argument expression. No 
matter how cleverly this is done, it introduces enough syntactic 
redundancy to make the solution verbose and clumsy.</P><P>Mythryl bites the bullet by treating <TT>printf</TT> (also <TT>sprintf</TT> and 
<TT>fprintf</TT>) as derived forms which are expanded early in the 
compiler front end into the underlying verbose syntax.</P><P>This expansion extracts the implicit type information from the format 
string, making it visible to the Mythryl typechecker, and thus making 
the entire construct work with a satisfying lack of visible redundancy.</P><P>This solution is a bit of a kludgey hack from a conceptual point of view. 
For example, aside from complicating the compiler with a special case 
hack, it means that the format string must be a constant known at 
compile time for this mechanism to work.</P><P>But this hack is an enormous win from a practical point of view, making 
common text formatting tasks markedly more pleasant:</P><PRE CLASS="verbatim">    printf "%g %s %d\n" 1.2 "foo" 32;
</PRE><P>The implemented syntax uses curried arguments and thus allows partial 
application of <TT>printf</TT> statements, which can occasionally be useful.</P><P>The limitation of the form to working only with format-strings 
known constant at compiler time is not a major restriction in practice. 
In the rare cases where the format string must be computed at runtime, 
one can always fall back to the underlying syntax: </P><PRE CLASS="verbatim">    sfprintf::printf' (compute_formatstring ()) [ sfprintf::FLOAT 1.2, sfprintf::STRING "foo", sfprintf::INT 32 ];
</PRE><P>where <TT>compute_formatstring</TT> is some user-supplied function. </P><P>As always, one may of course dispense with the qualifiers via wholesale importation: 
</P><PRE CLASS="verbatim">    include package   sfprintf;
    printf' (compute_formatstring ()) [ FLOAT 1.2, STRING "foo", INT 32 ];
</PRE><P>The same comments apply, <I>mutatis mutandis,</I> to <TT>sprintf</TT> and <TT>fprintf</TT>, all of which are ultimately implemented by the 
<A HREF="my-sfprintf.html#pkg:sfprintf">sfprintf</A> package, with an assist from <A HREF="my-src_lib_compiler_front_parser_raw-syntax_printf-format-string-to-raw-syntax_pkg.html#src/lib/compiler/front/parser/raw-syntax/printf-format-string-to-raw-syntax.pkg">src/lib/compiler/front/parser/raw-syntax/printf-format-string-to-raw-syntax.pkg</A>.</P>
<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-SML_vs_Mythryl.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Mythryl_for_SML_Programmers.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-Non-Syntactic_Differences.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
