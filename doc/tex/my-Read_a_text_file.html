<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>Read a text file</TITLE>
</HEAD>
<BODY >
<A HREF="my-Regular_expressions.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Recipes.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-Write_a_text_file.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc160">5.5.45</A>  Read a text file</H3><P>The simplest way to read a text file <TT>foo.txt</TT> as a list of lines is 
to use the <TT>lines</TT> function from the 
<A HREF="my-file.html#pkg:file">file</A> package:</P><PRE CLASS="verbatim">    line_list = file::as_lines "foo.txt";</PRE><P>Thus, for example, a quick and easy way to print out the contents of a file is</P><PRE CLASS="verbatim">    foreach (file::as_lines "foo.txt") {. print #line; };
</PRE><P>If you like to see more of what is going on under the hood, <TT>file::as_lines</TT> 
is equivalent to</P><PRE CLASS="verbatim">    fun lines filename
        =
        {    fd = file::open_for_read filename;
             line_list = file::read_lines fd;
             file::close_input fd;
             line_list;
        };
</PRE><P>where in turn <TT>file::read_lines</TT> is equivalent to</P><PRE CLASS="verbatim">    fun read_lines input_stream
        =
        read_lines' (input_stream, [])
        where
            fun read_lines' (input_stream, lines_so_far)
                =
                case (file::read_line input_stream)
                    NULL     =&gt; reverse lines_so_far; 
                    THE line =&gt; read_lines' (input_stream, line ! lines_so_far);
                esac;
        end;
</PRE><P>If you want to trap failures to open the specified file,
issue an error message, and continue, you can write</P><PRE CLASS="verbatim">    fun lines filename
        =
        {    fd = file::open_for_read filename;
             line_list = file::read_lines fd;
             file::close_input fd;
             line_list;
        }
        except io_exceptions::IO _
            =
            {   fprintf stderr "Could not open %s to read, treating it as empty.\n" filename;
                [];
            };
</PRE>

<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-Regular_expressions.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Recipes.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-Write_a_text_file.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
