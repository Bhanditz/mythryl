<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>src/lib/compiler/back/top/closures/dummy-nextcode-inlining-g.pkg</TITLE>
</HEAD>
<BODY >
<A HREF="my-src_lib_compiler_back_top_closures_allocprof_pkg.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Codebase__pkg_Files.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-src_lib_compiler_back_top_closures_freemap-unused_pkg.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc2347">15.4.459</A>  src/lib/compiler/back/top/closures/dummy-nextcode-inlining-g.pkg</H3><P>
<A NAME="src/lib/compiler/back/top/closures/dummy-nextcode-inlining-g.pkg"></A>
<CODE>##&nbsp;dummy-nextcode-inlining-g.pkg</CODE><BR><BR>
<CODE>#&nbsp;Compiled&nbsp;by:</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_compiler_core_sublib.html#src/lib/compiler/core.sublib"><TT>src/lib/compiler/core.sublib</TT></A><BR><BR><BR><BR><CODE>#&nbsp;This&nbsp;file&nbsp;implements&nbsp;one&nbsp;of&nbsp;the&nbsp;nextcode&nbsp;transforms.</CODE><BR>
<CODE>#&nbsp;For&nbsp;context,&nbsp;see&nbsp;the&nbsp;comments&nbsp;in</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_compiler_back_top_highcode_highcode-form_api.html#src/lib/compiler/back/top/highcode/highcode-form.api"><TT>src/lib/compiler/back/top/highcode/highcode-form.api</TT></A><BR><BR><BR><BR><CODE>#&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;may&nbsp;be&nbsp;the&nbsp;spot&nbsp;where&nbsp;cross-module&nbsp;inlining</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;currently&nbsp;not&nbsp;implemented.&nbsp;&nbsp;If&nbsp;so,&nbsp;the&nbsp;original</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;paper&nbsp;on&nbsp;this&nbsp;code&nbsp;is:</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Lambda-Splitting:&nbsp;A&nbsp;higher-order&nbsp;approach&nbsp;to&nbsp;cross-module&nbsp;optimizations.</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Matthias&nbsp;Blume&nbsp;and&nbsp;Andrew&nbsp;W&nbsp;Appel</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1997,&nbsp;12p</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://citeseer.ist.psu.edu/288704.html</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stefan&nbsp;Monnier&nbsp;in&nbsp;his&nbsp;thesis&nbsp;says&nbsp;this&nbsp;was&nbsp;never&nbsp;integrated&nbsp;into&nbsp;SML/NJ.</CODE><BR><BR><BR><BR><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"I&nbsp;don't&nbsp;believe&nbsp;in&nbsp;mathematics."</CODE><BR>
<CODE>#&nbsp;</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--Albert&nbsp;Einstein&nbsp;</CODE><BR><BR><BR>
<CODE>stipulate</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;ncf&nbsp;=&nbsp;&nbsp;nextcode_form;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;nextcode_form&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;from&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_compiler_back_top_nextcode_nextcode-form_pkg.html#src/lib/compiler/back/top/nextcode/nextcode-form.pkg"><TT>src/lib/compiler/back/top/nextcode/nextcode-form.pkg</TT></A><BR><CODE>herein</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;api&nbsp;Nextcode_Inlining&nbsp;{</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nextcode_inlining:&nbsp;&nbsp;ncf::Function&nbsp;-&gt;&nbsp;&nbsp;List(&nbsp;ncf::Function&nbsp;);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR>
<CODE>end;</CODE><BR><BR>
<CODE>#&nbsp;&nbsp;A&nbsp;dummy&nbsp;implementation&nbsp;for&nbsp;now.&nbsp;&nbsp;&nbsp;XXX&nbsp;BUGGO&nbsp;FIXME&nbsp;</CODE><BR>
<CODE>#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Machine_Properties&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;from&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_compiler_back_low_main_main_machine-properties_api.html#src/lib/compiler/back/low/main/main/machine-properties.api"><TT>src/lib/compiler/back/low/main/main/machine-properties.api</TT></A><BR><CODE>generic&nbsp;package&nbsp;&nbsp;&nbsp;nextcode_inlining_g&nbsp;(</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;===================</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;machine_properties:&nbsp;&nbsp;Machine_Properties&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Typically&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_compiler_back_low_main_intel32_machine-properties-intel32_pkg.html#src/lib/compiler/back/low/main/intel32/machine-properties-intel32.pkg"><TT>src/lib/compiler/back/low/main/intel32/machine-properties-intel32.pkg</TT></A><BR><CODE>)</CODE><BR>
<CODE>:&nbsp;(weak)&nbsp;&nbsp;Nextcode_Inlining&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Nextcode_Inlining&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;from&nbsp;&nbsp;&nbsp;</CODE><A HREF="#src/lib/compiler/back/top/closures/dummy-nextcode-inlining-g.pkg"><TT>src/lib/compiler/back/top/closures/dummy-nextcode-inlining-g.pkg</TT></A><BR><CODE>{</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;nextcode_inlining&nbsp;f&nbsp;=&nbsp;[f];</CODE><BR><BR>
<CODE>};</CODE><BR><BR><BR>
<CODE>/*</CODE><BR>
<CODE>generic&nbsp;package&nbsp;nextcode_inlining_g&nbsp;(machine_properties:&nbsp;Machine_Properties):&nbsp;NEXTCODE_INLINING&nbsp;=&nbsp;pkg</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;exception&nbsp;IMPOSSIBLE</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Currently&nbsp;we&nbsp;don't&nbsp;deal&nbsp;with&nbsp;floating&nbsp;point&nbsp;stuff.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;It&nbsp;is&nbsp;probably&nbsp;not&nbsp;worth&nbsp;the&nbsp;trouble&nbsp;here&nbsp;anyway.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;numRegs&nbsp;=&nbsp;machine_properties::numRegs</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;numCalleeSaves&nbsp;=&nbsp;machine_properties::numCalleeSaves</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;maxEscapeArgs&nbsp;=&nbsp;numRegs&nbsp;-&nbsp;1&nbsp;-&nbsp;numCalleeSaves&nbsp;-&nbsp;2</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;maxContArgs&nbsp;=&nbsp;numRegs&nbsp;-&nbsp;1&nbsp;-&nbsp;2</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;ncf&nbsp;=&nbsp;nextcode_form</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;sl&nbsp;=&nbsp;sorted_list</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;a&nbsp;=&nbsp;lambda_variable</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;m&nbsp;=&nbsp;int_red_black_map</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;=&nbsp;sl::enter</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;del&nbsp;=&nbsp;sl::rmv</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;join&nbsp;=&nbsp;sl::merge</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;xcl&nbsp;=&nbsp;sl::remove</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;mkset&nbsp;=&nbsp;sl::uniq</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;inset&nbsp;=&nbsp;sl::member</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;intersect&nbsp;=&nbsp;sl::intersect</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;lv_x&nbsp;(ncf::CODETEMP&nbsp;v,&nbsp;l)&nbsp;=&nbsp;add&nbsp;(v,&nbsp;l)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;lv_x&nbsp;(ncf::LABEL&nbsp;v,&nbsp;l)&nbsp;=&nbsp;add&nbsp;(v,&nbsp;l)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;lv_x&nbsp;(_,&nbsp;l)&nbsp;=&nbsp;l</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;infix&nbsp;@@@</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;(f&nbsp;@@@&nbsp;g)&nbsp;(x,&nbsp;y)&nbsp;=&nbsp;f&nbsp;(g&nbsp;x,&nbsp;y)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;fst&nbsp;(x,&nbsp;_)&nbsp;=&nbsp;x</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;lv_record&nbsp;(l,&nbsp;v,&nbsp;elv)&nbsp;=&nbsp;fold_forward&nbsp;(lv_x&nbsp;@@@&nbsp;fst)&nbsp;(del&nbsp;(v,&nbsp;elv))&nbsp;l</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;lv_xv&nbsp;(x,&nbsp;v,&nbsp;elv)&nbsp;=&nbsp;lv_x&nbsp;(x,&nbsp;del&nbsp;(v,&nbsp;elv))</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;lv_app&nbsp;(x,&nbsp;l)&nbsp;=&nbsp;fold_forward&nbsp;lv_x&nbsp;(lv_x&nbsp;(x,&nbsp;[]))&nbsp;l</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;lv_setter&nbsp;(l,&nbsp;elv)&nbsp;=&nbsp;fold_forward&nbsp;lv_x&nbsp;elv&nbsp;l</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;lv_calc&nbsp;(l,&nbsp;v,&nbsp;elv)&nbsp;=&nbsp;fold_forward&nbsp;lv_x&nbsp;(del&nbsp;(v,&nbsp;elv))&nbsp;l</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;lv_branch&nbsp;(l,&nbsp;v,&nbsp;elv1,&nbsp;elv2)&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fold_forward&nbsp;lv_x&nbsp;(del&nbsp;(v,&nbsp;join&nbsp;(elv1,&nbsp;elv2)))&nbsp;l</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;lv'switch&nbsp;(x,&nbsp;v,&nbsp;el)&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv_x&nbsp;(x,&nbsp;del&nbsp;(v,&nbsp;fold_forward&nbsp;(join&nbsp;@@@&nbsp;live)&nbsp;[]&nbsp;el))</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;lv'branch&nbsp;(l,&nbsp;v,&nbsp;e1,&nbsp;e2)&nbsp;=&nbsp;lv_branch&nbsp;(l,&nbsp;v,&nbsp;live&nbsp;e1,&nbsp;live&nbsp;e2)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;lv'_fix&nbsp;(l,&nbsp;elv)&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;f&nbsp;((_,&nbsp;v,&nbsp;vl,&nbsp;_,&nbsp;e),&nbsp;(lv,&nbsp;bv))&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(join&nbsp;(xcl&nbsp;(mkset&nbsp;vl,&nbsp;live&nbsp;e),&nbsp;lv),&nbsp;add&nbsp;(v,&nbsp;bv))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(lv,&nbsp;bv)&nbsp;=&nbsp;fold_forward&nbsp;f&nbsp;(elv,&nbsp;[])&nbsp;l</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xcl&nbsp;(bv,&nbsp;lv)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;live&nbsp;(ncf::RECORD&nbsp;(_,&nbsp;l,&nbsp;v,&nbsp;e))&nbsp;=&nbsp;lv_record&nbsp;(l,&nbsp;v,&nbsp;live&nbsp;e)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;live&nbsp;(ncf::GET_FIELD&nbsp;(_,&nbsp;x,&nbsp;v,&nbsp;_,&nbsp;e))&nbsp;=&nbsp;lv_xv&nbsp;(x,&nbsp;v,&nbsp;live&nbsp;e)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;live&nbsp;(ncf::OFFSET&nbsp;(_,&nbsp;x,&nbsp;v,&nbsp;e))&nbsp;=&nbsp;lv_xv&nbsp;(x,&nbsp;v,&nbsp;live&nbsp;e)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;live&nbsp;(ncf::APPLY&nbsp;(x,&nbsp;l))&nbsp;=&nbsp;lv_app&nbsp;(x,&nbsp;l)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;live&nbsp;(ncf::FIX&nbsp;(l,&nbsp;e))&nbsp;=&nbsp;lv'_fix&nbsp;(l,&nbsp;live&nbsp;e)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;live&nbsp;(ncf::SWITCH&nbsp;(x,&nbsp;v,&nbsp;el))&nbsp;=&nbsp;lv'switch&nbsp;(x,&nbsp;v,&nbsp;el)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;live&nbsp;(ncf::BRANCH&nbsp;(_,&nbsp;l,&nbsp;v,&nbsp;e1,&nbsp;e2))&nbsp;=&nbsp;lv'branch&nbsp;(l,&nbsp;v,&nbsp;e1,&nbsp;e2)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;live&nbsp;(ncf::SETTER&nbsp;(_,&nbsp;l,&nbsp;e))&nbsp;=&nbsp;lv_setter&nbsp;(l,&nbsp;live&nbsp;e)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;live&nbsp;(ncf::LOOKER&nbsp;(_,&nbsp;l,&nbsp;v,&nbsp;_,&nbsp;e))&nbsp;=&nbsp;lv_calc&nbsp;(l,&nbsp;v,&nbsp;live&nbsp;e)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;live&nbsp;(ncf::ARITH&nbsp;(_,&nbsp;l,&nbsp;v,&nbsp;_,&nbsp;e))&nbsp;=&nbsp;lv_calc&nbsp;(l,&nbsp;v,&nbsp;live&nbsp;e)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;live&nbsp;(ncf::PURE&nbsp;(_,&nbsp;l,&nbsp;v,&nbsp;_,&nbsp;e))&nbsp;=&nbsp;lv_calc&nbsp;(l,&nbsp;v,&nbsp;live&nbsp;e)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;m&nbsp;=&nbsp;int_red_black_map</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;scc&nbsp;stuff&nbsp;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;enum&nbsp;node&nbsp;=&nbsp;N&nbsp;of&nbsp;{&nbsp;id:&nbsp;Int,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function:&nbsp;Null_Or(&nbsp;ncf::function&nbsp;),</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edges:&nbsp;REF(&nbsp;&nbsp;List(&nbsp;&nbsp;node&nbsp;)&nbsp;),</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fv:&nbsp;List(&nbsp;a::Lambda_Variable&nbsp;)&nbsp;}</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;scc_node&nbsp;=&nbsp;pkg</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;Key&nbsp;=&nbsp;node</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;compare&nbsp;(N&nbsp;n1,&nbsp;N&nbsp;n2)&nbsp;=&nbsp;int::compare&nbsp;(n1.id,&nbsp;n2.id)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;scc&nbsp;=&nbsp;graph_strongly_connected_components_g&nbsp;(scc_node)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;scc&nbsp;(l,&nbsp;fv,&nbsp;e)&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;=&nbsp;N&nbsp;{&nbsp;id&nbsp;=&nbsp;-1,&nbsp;function&nbsp;=&nbsp;NULL,&nbsp;edges&nbsp;=&nbsp;REF&nbsp;[],&nbsp;fv&nbsp;=&nbsp;fv&nbsp;}</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;mkn&nbsp;(f&nbsp;as&nbsp;(_,&nbsp;v,&nbsp;vl,&nbsp;_,&nbsp;b))&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N&nbsp;{&nbsp;id&nbsp;=&nbsp;v,&nbsp;function&nbsp;=&nbsp;THE&nbsp;f,&nbsp;edges&nbsp;=&nbsp;REF&nbsp;[],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fv&nbsp;=&nbsp;xcl&nbsp;(mkset&nbsp;vl,&nbsp;live&nbsp;b)&nbsp;}</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nodes&nbsp;=&nbsp;root&nbsp;.&nbsp;map&nbsp;mkn&nbsp;l</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;addif&nbsp;n&nbsp;n'&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;N&nbsp;{&nbsp;edges,&nbsp;fv,&nbsp;...&nbsp;}&nbsp;=&nbsp;n'</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;N&nbsp;{&nbsp;edges&nbsp;=&nbsp;bedges,&nbsp;...&nbsp;}&nbsp;=&nbsp;n</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;n&nbsp;of</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N&nbsp;{&nbsp;function&nbsp;=&nbsp;THE&nbsp;(k,&nbsp;f,&nbsp;_,&nbsp;_,&nbsp;_),&nbsp;...&nbsp;}&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;inset&nbsp;fv&nbsp;f&nbsp;then</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(edges&nbsp;:=&nbsp;n&nbsp;.&nbsp;*edges;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Add&nbsp;back&nbsp;edge&nbsp;for&nbsp;known&nbsp;functions.&nbsp;This&nbsp;forces</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;the&nbsp;two&nbsp;nodes&nbsp;to&nbsp;be&nbsp;in&nbsp;the&nbsp;same&nbsp;scc,&nbsp;which&nbsp;is</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;necessary&nbsp;because&nbsp;calls&nbsp;to&nbsp;known&nbsp;functions</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;cannot&nbsp;go&nbsp;accross&nbsp;code&nbsp;segments</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;k&nbsp;of</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::ESCAPE&nbsp;=&gt;&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ncf::CONT&nbsp;=&gt;&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;_&nbsp;=&gt;&nbsp;bedges&nbsp;:=&nbsp;n'&nbsp;.&nbsp;*bedges)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;_&nbsp;=&gt;&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;enter&nbsp;all&nbsp;edges&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;(\\&nbsp;n&nbsp;=&gt;&nbsp;(apply&nbsp;(addif&nbsp;n)&nbsp;nodes))&nbsp;nodes</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;outgoing&nbsp;edges&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;out&nbsp;(N&nbsp;{&nbsp;edges&nbsp;=&nbsp;REF&nbsp;e,&nbsp;...&nbsp;}&nbsp;)&nbsp;=&nbsp;e</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;calculate&nbsp;sccs&nbsp;of&nbsp;this&nbsp;graph;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;the&nbsp;top&nbsp;scc&nbsp;must&nbsp;contain&nbsp;the&nbsp;original&nbsp;root&nbsp;node&nbsp;(f&nbsp;=&nbsp;NULL)!&nbsp;*/</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;top&nbsp;.&nbsp;sccs&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scfcf::sccTop&nbsp;{&nbsp;root&nbsp;=&nbsp;root,&nbsp;outgoingEdgesOf&nbsp;=&nbsp;out&nbsp;}</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;component&nbsp;l&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;xtr&nbsp;(N&nbsp;{&nbsp;function&nbsp;=&nbsp;THE&nbsp;f,&nbsp;fv,&nbsp;...&nbsp;},&nbsp;(fl,&nbsp;lv,&nbsp;bv))&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(f&nbsp;.&nbsp;fl,&nbsp;join&nbsp;(fv,&nbsp;lv),&nbsp;add&nbsp;(#2&nbsp;f,&nbsp;bv))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;xtr&nbsp;(N&nbsp;{&nbsp;function&nbsp;=&nbsp;NULL,&nbsp;...&nbsp;},&nbsp;x)&nbsp;=&nbsp;x</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fold_forward&nbsp;xtr&nbsp;([],&nbsp;[],&nbsp;[])&nbsp;l</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;top'&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;top&nbsp;of</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[N&nbsp;{&nbsp;function&nbsp;=&nbsp;NULL,&nbsp;...&nbsp;}&nbsp;]&nbsp;=&gt;&nbsp;NULL</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;_&nbsp;=&gt;&nbsp;THE&nbsp;(component&nbsp;top)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;components&nbsp;=&nbsp;map&nbsp;component&nbsp;sccs,&nbsp;top&nbsp;=&nbsp;top'&nbsp;}</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Don't&nbsp;keep&nbsp;type&nbsp;info&nbsp;about&nbsp;known&nbsp;functions,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;because&nbsp;they&nbsp;cannot&nbsp;be&nbsp;passed&nbsp;to&nbsp;other&nbsp;codeunits&nbsp;anyway:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;enum&nbsp;tyinfo&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NORMALTY&nbsp;of&nbsp;ncf::cty&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;ordinary&nbsp;ncf::cty&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;KNOWNTY&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>#&nbsp;&nbsp;known&nbsp;function&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;CONTTY&nbsp;of&nbsp;List(&nbsp;ncf::cty&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>#&nbsp;&nbsp;Argument&nbsp;types&nbsp;of&nbsp;fate.&nbsp;function&nbsp;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;tymap&nbsp;=&nbsp;m::intmap(&nbsp;tyinfo&nbsp;)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;rectyn&nbsp;0&nbsp;=&nbsp;ncf::INTt</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;rectyn&nbsp;n&nbsp;=&nbsp;ncf::PTRt&nbsp;(ncf::RPT&nbsp;n)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;recty&nbsp;lv&nbsp;=&nbsp;rectyn&nbsp;(length&nbsp;lv)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;madd&nbsp;(v,&nbsp;t,&nbsp;m)&nbsp;=&nbsp;m::add&nbsp;(m,&nbsp;v,&nbsp;NORMALTY&nbsp;t)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;maddf&nbsp;((ncf::ESCAPE,&nbsp;v,&nbsp;_,&nbsp;_,&nbsp;_),&nbsp;m)&nbsp;=&nbsp;m::add&nbsp;(m,&nbsp;v,&nbsp;NORMALTY&nbsp;ncf::FUNt)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;maddf&nbsp;((ncf::CONT,&nbsp;v,&nbsp;_,&nbsp;tl,&nbsp;_),&nbsp;m)&nbsp;=&nbsp;m::add&nbsp;(m,&nbsp;v,&nbsp;CONTTY&nbsp;tl)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;maddf&nbsp;((_,&nbsp;v,&nbsp;_,&nbsp;_,&nbsp;_),&nbsp;m)&nbsp;=&nbsp;m::add&nbsp;(m,&nbsp;v,&nbsp;KNOWNTY)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;maddal&nbsp;([],&nbsp;[],&nbsp;m)&nbsp;=&nbsp;m</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;maddal&nbsp;(v&nbsp;.&nbsp;vl,&nbsp;t&nbsp;.&nbsp;tl,&nbsp;m)&nbsp;=&nbsp;maddal&nbsp;(vl,&nbsp;tl,&nbsp;madd&nbsp;(v,&nbsp;t,&nbsp;m))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;maddal&nbsp;_&nbsp;=&nbsp;raise&nbsp;exception&nbsp;IMPOSSIBLE</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;reconst&nbsp;(expression,&nbsp;tymap,&nbsp;units)&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;expression&nbsp;of</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::RECORD&nbsp;(k,&nbsp;l,&nbsp;v,&nbsp;e)&nbsp;=&gt;&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tymap'&nbsp;=&nbsp;madd&nbsp;(v,&nbsp;recty&nbsp;l,&nbsp;tymap)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(e',&nbsp;units',&nbsp;lv)&nbsp;=&nbsp;reconst&nbsp;(e,&nbsp;tymap',&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv'&nbsp;=&nbsp;lv_record&nbsp;(l,&nbsp;v,&nbsp;lv)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::RECORD&nbsp;(k,&nbsp;l,&nbsp;v,&nbsp;e'),&nbsp;units',&nbsp;lv')</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ncf::GET_FIELD&nbsp;(i,&nbsp;x,&nbsp;v,&nbsp;t,&nbsp;e)&nbsp;=&gt;&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tymap'&nbsp;=&nbsp;madd&nbsp;(v,&nbsp;t,&nbsp;tymap)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(e',&nbsp;units',&nbsp;lv)&nbsp;=&nbsp;reconst&nbsp;(e,&nbsp;tymap',&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv'&nbsp;=&nbsp;lv_xv&nbsp;(x,&nbsp;v,&nbsp;lv)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::GET_FIELD&nbsp;(i,&nbsp;x,&nbsp;v,&nbsp;t,&nbsp;e'),&nbsp;units',&nbsp;lv')</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ncf::OFFSET&nbsp;(i,&nbsp;x,&nbsp;v,&nbsp;e)&nbsp;=&gt;&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tymap'&nbsp;=&nbsp;madd&nbsp;(v,&nbsp;ncf::bogt,&nbsp;tymap)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(e',&nbsp;units',&nbsp;lv)&nbsp;=&nbsp;reconst&nbsp;(e,&nbsp;tymap',&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv'&nbsp;=&nbsp;lv_xv&nbsp;(x,&nbsp;v,&nbsp;lv)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::OFFSET&nbsp;(i,&nbsp;x,&nbsp;v,&nbsp;e'),&nbsp;units',&nbsp;lv')</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ncf::APPLY&nbsp;(x,&nbsp;l)&nbsp;=&gt;&nbsp;(expression,&nbsp;units,&nbsp;lv_app&nbsp;(x,&nbsp;l))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ncf::FIX&nbsp;(fl,&nbsp;e)&nbsp;=&gt;&nbsp;reconst_fix&nbsp;(fl,&nbsp;e,&nbsp;tymap,&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ncf::SWITCH&nbsp;(x,&nbsp;v,&nbsp;el)&nbsp;=&gt;&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;r&nbsp;(e,&nbsp;(u,&nbsp;lv,&nbsp;el))&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(e',&nbsp;u',&nbsp;lv')&nbsp;=&nbsp;reconst&nbsp;(e,&nbsp;tymap,&nbsp;u)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(u',&nbsp;join&nbsp;(lv,&nbsp;lv'),&nbsp;e'&nbsp;.&nbsp;el)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(units',&nbsp;lv,&nbsp;el')&nbsp;=&nbsp;fold_backward&nbsp;r&nbsp;(units,&nbsp;[],&nbsp;[])&nbsp;el</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::SWITCH&nbsp;(x,&nbsp;v,&nbsp;el'),&nbsp;units',&nbsp;lv)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ncf::BRANCH&nbsp;(b,&nbsp;l,&nbsp;v,&nbsp;e1,&nbsp;e2)&nbsp;=&gt;&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tymap'&nbsp;=&nbsp;madd&nbsp;(v,&nbsp;ncf::INTt,&nbsp;tymap)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(e1',&nbsp;units',&nbsp;lv1)&nbsp;=&nbsp;reconst&nbsp;(e1,&nbsp;tymap',&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(e2',&nbsp;units'',&nbsp;lv2)&nbsp;=&nbsp;reconst&nbsp;(e2,&nbsp;tymap',&nbsp;units')</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv&nbsp;=&nbsp;lv_branch&nbsp;(l,&nbsp;v,&nbsp;lv1,&nbsp;lv2)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::BRANCH&nbsp;(b,&nbsp;l,&nbsp;v,&nbsp;e1',&nbsp;e2'),&nbsp;units'',&nbsp;lv)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ncf::SETTER&nbsp;(s,&nbsp;l,&nbsp;e)&nbsp;=&gt;&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(e',&nbsp;units',&nbsp;lv)&nbsp;=&nbsp;reconst&nbsp;(e,&nbsp;tymap,&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv'&nbsp;=&nbsp;lv_setter&nbsp;(l,&nbsp;lv)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::SETTER&nbsp;(s,&nbsp;l,&nbsp;e),&nbsp;units',&nbsp;lv')</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ncf::LOOKER&nbsp;(p,&nbsp;l,&nbsp;v,&nbsp;t,&nbsp;e)&nbsp;=&gt;&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tymap'&nbsp;=&nbsp;madd&nbsp;(v,&nbsp;t,&nbsp;tymap)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(e',&nbsp;units',&nbsp;lv)&nbsp;=&nbsp;reconst&nbsp;(e,&nbsp;tymap',&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv'&nbsp;=&nbsp;lv_calc&nbsp;(l,&nbsp;v,&nbsp;lv)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::LOOKER&nbsp;(p,&nbsp;l,&nbsp;v,&nbsp;t,&nbsp;e'),&nbsp;units',&nbsp;lv')</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ncf::ARITH&nbsp;(p,&nbsp;l,&nbsp;v,&nbsp;t,&nbsp;e)&nbsp;=&gt;&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tymap'&nbsp;=&nbsp;madd&nbsp;(v,&nbsp;t,&nbsp;tymap)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(e',&nbsp;units',&nbsp;lv)&nbsp;=&nbsp;reconst&nbsp;(e,&nbsp;tymap',&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv'&nbsp;=&nbsp;lv_calc&nbsp;(l,&nbsp;v,&nbsp;lv)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::ARITH&nbsp;(p,&nbsp;l,&nbsp;v,&nbsp;t,&nbsp;e'),&nbsp;units',&nbsp;lv')</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ncf::PURE&nbsp;(p,&nbsp;l,&nbsp;v,&nbsp;t,&nbsp;e)&nbsp;=&gt;&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tymap'&nbsp;=&nbsp;madd&nbsp;(v,&nbsp;t,&nbsp;tymap)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(e',&nbsp;units',&nbsp;lv)&nbsp;=&nbsp;reconst&nbsp;(e,&nbsp;tymap',&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv'&nbsp;=&nbsp;lv_calc&nbsp;(l,&nbsp;v,&nbsp;lv)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::PURE&nbsp;(p,&nbsp;l,&nbsp;v,&nbsp;t,&nbsp;e'),&nbsp;units',&nbsp;lv')</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;also&nbsp;reconst_fix&nbsp;(fl,&nbsp;e,&nbsp;tymap,&nbsp;units)&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tymap&nbsp;=&nbsp;fold_forward&nbsp;maddf&nbsp;tymap&nbsp;fl</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(e,&nbsp;units,&nbsp;lv)&nbsp;=&nbsp;reconst&nbsp;(e,&nbsp;tymap,&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;{&nbsp;components,&nbsp;top&nbsp;}&nbsp;=&nbsp;scc&nbsp;(fl,&nbsp;lv,&nbsp;e)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;recursively&nbsp;apply&nbsp;reconstruction&nbsp;to&nbsp;fates&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;reconst_cont&nbsp;((ncf::CONT,&nbsp;v,&nbsp;vl,&nbsp;tl,&nbsp;e),&nbsp;(u,&nbsp;fl))&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tymap&nbsp;=&nbsp;maddal&nbsp;(vl,&nbsp;tl,&nbsp;tymap)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(e,&nbsp;u,&nbsp;_)&nbsp;=&nbsp;reconst&nbsp;(e,&nbsp;tymap,&nbsp;u)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(u,&nbsp;(ncf::CONT,&nbsp;v,&nbsp;vl,&nbsp;tl,&nbsp;e)&nbsp;.&nbsp;fl)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;reconst_cont&nbsp;(f,&nbsp;(u,&nbsp;fl))&nbsp;=&nbsp;(u,&nbsp;f&nbsp;.&nbsp;fl)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;reconst_comp&nbsp;(c,&nbsp;u)&nbsp;=&nbsp;fold_forward&nbsp;reconst_cont&nbsp;(u,&nbsp;[])&nbsp;c</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;incorporate&nbsp;top&nbsp;component&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(e,&nbsp;lv,&nbsp;units)&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;top&nbsp;of</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL&nbsp;=&gt;&nbsp;(e,&nbsp;lv,&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;THE&nbsp;(bfl,&nbsp;blv,&nbsp;bbv)&nbsp;=&gt;&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(u,&nbsp;c)&nbsp;=&nbsp;reconst_comp&nbsp;(bfl,&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::FIX&nbsp;(c,&nbsp;e),&nbsp;xcl&nbsp;(bbv,&nbsp;join&nbsp;(blv,&nbsp;lv)),&nbsp;u)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;a&nbsp;component&nbsp;is&nbsp;eligible&nbsp;to&nbsp;be&nbsp;put&nbsp;into&nbsp;its&nbsp;own&nbsp;unit&nbsp;if</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;-&nbsp;it&nbsp;doesn't&nbsp;contain&nbsp;ncf::CONT&nbsp;members</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;-&nbsp;none&nbsp;of&nbsp;its&nbsp;free&nbsp;variables&nbsp;refers&nbsp;to&nbsp;a&nbsp;known&nbsp;function</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;stays&nbsp;(fl,&nbsp;fv)&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;isCont&nbsp;(ncf::CONT,&nbsp;_,&nbsp;_,&nbsp;_,&nbsp;_)&nbsp;=&nbsp;TRUE&nbsp;</CODE><CODE>|&nbsp;isCont&nbsp;_&nbsp;=&nbsp;FALSE</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;impossibleArg&nbsp;v&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;m::lookup&nbsp;tymap&nbsp;v&nbsp;of</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KNOWNTY&nbsp;=&gt;&nbsp;TRUE</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;NORMALTY&nbsp;ncf::CNTt&nbsp;=&gt;&nbsp;TRUE</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;_&nbsp;=&gt;&nbsp;FALSE</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list::exists&nbsp;isCont&nbsp;fl&nbsp;or&nbsp;list::exists&nbsp;impossibleArg&nbsp;fv</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;move&nbsp;a&nbsp;component&nbsp;into&nbsp;its&nbsp;own&nbsp;code&nbsp;unit&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;movecomponent&nbsp;(fl,&nbsp;lv,&nbsp;xl,&nbsp;yl,&nbsp;e,&nbsp;units)&nbsp;=&nbsp;let</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;code&nbsp;for&nbsp;the&nbsp;new&nbsp;unit:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;(ncf::ESCAPE,&nbsp;void_var,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;[cont_var,&nbsp;arg_var],&nbsp;[ncf::CNTt,&nbsp;ncf::bogt],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;FIX&nbsp;((ESCAPE,&nbsp;fun_var,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[cont_var,&nbsp;exl...],&nbsp;[ncf::CNTt,&nbsp;extl...],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DECODESEND&nbsp;(exl...,&nbsp;xl...,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FIX&nbsp;(fl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENCODERCV&nbsp;(yl,&nbsp;eyl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPLY&nbsp;(cont_var,&nbsp;eyl)))))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RECORD&nbsp;([arg_var,&nbsp;fun_var],&nbsp;res_var,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPLY&nbsp;(cont_var,&nbsp;[res_var]))))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;code&nbsp;that&nbsp;replaces&nbsp;the&nbsp;original&nbsp;occurence&nbsp;of&nbsp;the&nbsp;component:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;FIX&nbsp;((CONT,&nbsp;cont_var,&nbsp;eyl,&nbsp;[FUNt...],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DECODERCV&nbsp;(eyl,&nbsp;yl,&nbsp;e)),</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ENCODESEND&nbsp;(xl,&nbsp;exl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;APPLY&nbsp;(fun_var,&nbsp;[cont_var,&nbsp;exl...])))</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void_var&nbsp;=&nbsp;a::make_lambda_variable&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cont_var&nbsp;=&nbsp;a::make_lambda_variable&nbsp;()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;"cont"&nbsp;==&nbsp;"fate"</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg_var&nbsp;=&nbsp;a::make_lambda_variable&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun_var&nbsp;=&nbsp;a::make_lambda_variable&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cont_var&nbsp;=&nbsp;a::make_lambda_variable&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res_var&nbsp;=&nbsp;a::make_lambda_variable&nbsp;()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;"res"&nbsp;==&nbsp;"result"</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;firstN&nbsp;(0,&nbsp;l)&nbsp;=&nbsp;([],&nbsp;l)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;firstN&nbsp;(n,&nbsp;h&nbsp;.&nbsp;t)&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(f,&nbsp;r)&nbsp;=&nbsp;firstN&nbsp;(n&nbsp;-&nbsp;1,&nbsp;t)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(h&nbsp;.&nbsp;f,&nbsp;r)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;firstN&nbsp;_&nbsp;=&nbsp;raise&nbsp;exception&nbsp;IMPOSSIBLE</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;selectall&nbsp;(base,&nbsp;vl,&nbsp;tl,&nbsp;e)&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;base&nbsp;=&nbsp;ncf::CODETEMP&nbsp;base</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;s&nbsp;([],&nbsp;[],&nbsp;_,&nbsp;e)&nbsp;=&nbsp;e</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;s&nbsp;(h&nbsp;.&nbsp;t,&nbsp;th&nbsp;.&nbsp;tt,&nbsp;i,&nbsp;e)&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;(t,&nbsp;tt,&nbsp;i&nbsp;+&nbsp;1,&nbsp;ncf::GET_FIELD&nbsp;(i,&nbsp;base,&nbsp;h,&nbsp;th,&nbsp;e))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;(vl,&nbsp;tl,&nbsp;0,&nbsp;e)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;funty&nbsp;_&nbsp;=&nbsp;ncf::FUNt</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;recvar&nbsp;v&nbsp;=&nbsp;(ncf::CODETEMP&nbsp;v,&nbsp;ncf::OFFp&nbsp;0)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Deal&nbsp;with&nbsp;received&nbsp;values&nbsp;(all&nbsp;of&nbsp;them&nbsp;are&nbsp;functions)&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ny&nbsp;=&nbsp;length&nbsp;yl</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(ysend,&nbsp;mk_yrcv)&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;ny&nbsp;&lt;=&nbsp;maxContArgs&nbsp;then</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::APPLY&nbsp;(ncf::CODETEMP&nbsp;cont_var,&nbsp;map&nbsp;ncf::CODETEMP&nbsp;yl),</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;body&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::FIX&nbsp;([(ncf::CONT,&nbsp;cont_var,&nbsp;yl,&nbsp;map&nbsp;funty&nbsp;yl,&nbsp;e)],&nbsp;body))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;npy&nbsp;=&nbsp;ny&nbsp;+&nbsp;1&nbsp;-&nbsp;maxContArgs</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(pyl,&nbsp;ryl)&nbsp;=&nbsp;firstN&nbsp;(npy,&nbsp;yl)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;=&nbsp;a::make_lambda_variable&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::RECORD&nbsp;(a::RK_RECORD,&nbsp;map&nbsp;recvar&nbsp;pyl,&nbsp;v,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::APPLY&nbsp;(ncf::CODETEMP&nbsp;cont_var,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::CODETEMP&nbsp;v)&nbsp;.&nbsp;map&nbsp;ncf::CODETEMP&nbsp;ryl)),</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;body&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::FIX&nbsp;([(ncf::CONT,&nbsp;cont_var,&nbsp;v&nbsp;.&nbsp;ryl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(recty&nbsp;pyl)&nbsp;.&nbsp;map&nbsp;funty&nbsp;ryl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selectall&nbsp;(v,&nbsp;pyl,&nbsp;map&nbsp;funty&nbsp;pyl,&nbsp;e))],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;put&nbsp;the&nbsp;component&nbsp;in&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fix'n'ysend&nbsp;=&nbsp;ncf::FIX&nbsp;(fl,&nbsp;ysend)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Wrap&nbsp;a&nbsp;CNTt&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;passed&nbsp;as&nbsp;a&nbsp;FUNt.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;tl&nbsp;lists&nbsp;argument&nbsp;types&nbsp;*/</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;wrapcnt&nbsp;(xvar,&nbsp;x'var,&nbsp;tl,&nbsp;e)&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl&nbsp;=&nbsp;map&nbsp;(\\&nbsp;_&nbsp;=&gt;&nbsp;a::make_lambda_variable&nbsp;())&nbsp;tl</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ikvar&nbsp;=&nbsp;a::make_lambda_variable&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::FIX&nbsp;([(ncf::ESCAPE,&nbsp;x'var,&nbsp;ikvar&nbsp;.&nbsp;vl,&nbsp;ncf::CNTt&nbsp;.&nbsp;tl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::APPLY&nbsp;(ncf::CODETEMP&nbsp;xvar,&nbsp;map&nbsp;ncf::CODETEMP&nbsp;vl))],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;unwrap&nbsp;FUNt&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;CNTt.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Even&nbsp;though&nbsp;it&nbsp;ignores&nbsp;it&nbsp;our&nbsp;escaping&nbsp;version&nbsp;of&nbsp;the</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;fate&nbsp;expects&nbsp;a&nbsp;fate&nbsp;of&nbsp;its&nbsp;own.&nbsp;&nbsp;We&nbsp;have</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;to&nbsp;pull&nbsp;one&nbsp;out&nbsp;of&nbsp;the&nbsp;air...&nbsp;cont_var&nbsp;*/</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;unwrapcnt&nbsp;(x'var,&nbsp;xvar,&nbsp;tl,&nbsp;e)&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vl&nbsp;=&nbsp;map&nbsp;(\\&nbsp;_&nbsp;=&gt;&nbsp;a::make_lambda_variable&nbsp;())&nbsp;tl</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::FIX&nbsp;([(ncf::CONT,&nbsp;xvar,&nbsp;vl,&nbsp;tl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::APPLY&nbsp;(ncf::CODETEMP&nbsp;x'var,&nbsp;map&nbsp;ncf::CODETEMP&nbsp;(cont_var&nbsp;.&nbsp;vl)))],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;wrap'gen&nbsp;other&nbsp;(v,&nbsp;(evl,&nbsp;etl,&nbsp;mkwE,&nbsp;mkuwE))&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;m::lookup&nbsp;tymap&nbsp;v&nbsp;of</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KNOWNTY&nbsp;=&gt;&nbsp;raise&nbsp;exception&nbsp;IMPOSSIBLE</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;CONTTY&nbsp;tl&nbsp;=&gt;&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ev&nbsp;=&nbsp;a::make_lambda_variable&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ev&nbsp;.&nbsp;evl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::FUNt&nbsp;.&nbsp;etl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;e&nbsp;=&gt;&nbsp;wrapcnt&nbsp;(v,&nbsp;ev,&nbsp;tl,&nbsp;mkwE&nbsp;e),</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;e&nbsp;=&gt;&nbsp;unwrapcnt&nbsp;(ev,&nbsp;v,&nbsp;tl,&nbsp;mkuwE&nbsp;e))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;NORMALTY&nbsp;ncf::CNTt&nbsp;=&gt;&nbsp;raise&nbsp;exception&nbsp;IMPOSSIBLE</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;NORMALTY&nbsp;ct&nbsp;=&gt;&nbsp;other&nbsp;(v,&nbsp;ct,&nbsp;evl,&nbsp;etl,&nbsp;mkwE,&nbsp;mkuwE)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;wrap&nbsp;a&nbsp;variable,&nbsp;so&nbsp;I&nbsp;can&nbsp;stick&nbsp;it&nbsp;into&nbsp;a&nbsp;record&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrap'rec&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;other&nbsp;(v,&nbsp;ct,&nbsp;evl,&nbsp;etl,&nbsp;mkwE,&nbsp;mkuwE)&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;w&nbsp;(wrap,&nbsp;unwrap)&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ev&nbsp;=&nbsp;a::make_lambda_variable&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ev&nbsp;.&nbsp;evl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::bogt&nbsp;.&nbsp;etl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;e&nbsp;=&gt;&nbsp;ncf::PURE&nbsp;(wrap,&nbsp;[ncf::CODETEMP&nbsp;v],&nbsp;ev,&nbsp;ncf::bogt,&nbsp;mkwE&nbsp;e),</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\\&nbsp;e&nbsp;=&gt;&nbsp;ncf::PURE&nbsp;(unwrap,&nbsp;[ncf::CODETEMP&nbsp;ev],&nbsp;v,&nbsp;ct,&nbsp;mkuwE&nbsp;e))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;ct&nbsp;of</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::INT1t&nbsp;=&gt;&nbsp;w&nbsp;(ncf::P.i32wrap,&nbsp;ncf::P.i32unwrap)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ncf::FLTt&nbsp;=&gt;&nbsp;w&nbsp;(ncf::P.fwrap,&nbsp;ncf::P.funwrap)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;_&nbsp;=&gt;&nbsp;(v&nbsp;.&nbsp;evl,&nbsp;ct&nbsp;.&nbsp;etl,&nbsp;mkwE,&nbsp;mkuwE)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrap'gen&nbsp;other</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;wrap&nbsp;fates&nbsp;only&nbsp;(for&nbsp;argument&nbsp;passing)&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrap'count&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;other&nbsp;(v,&nbsp;ct,&nbsp;evl,&nbsp;etl,&nbsp;mkwE,&nbsp;mkuwE)&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(v&nbsp;.&nbsp;evl,&nbsp;ct&nbsp;.&nbsp;etl,&nbsp;mkwE,&nbsp;mkuwE)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrap'gen&nbsp;other</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nx&nbsp;=&nbsp;length&nbsp;xl</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unitresult&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::RECORD&nbsp;(a::RK_RECORD,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[recvar&nbsp;arg_var,&nbsp;recvar&nbsp;fun_var],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res_var,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::APPLY&nbsp;(ncf::CODETEMP&nbsp;cont_var,&nbsp;[ncf::CODETEMP&nbsp;res_var]))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(xsend,&nbsp;xrcv)&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;nx&nbsp;==&nbsp;0&nbsp;then</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::APPLY&nbsp;(ncf::CODETEMP&nbsp;fun_var,&nbsp;[ncf::CODETEMP&nbsp;cont_var,&nbsp;ncf::INT&nbsp;0]),</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::FIX&nbsp;([(ncf::ESCAPE,&nbsp;fun_var,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[cont_var,&nbsp;a::make_lambda_variable&nbsp;()],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ncf::CNTt,&nbsp;ncf::INTt],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fix'n'ysend)],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unitresult))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;if&nbsp;nx&nbsp;&lt;=&nbsp;maxEscapeArgs&nbsp;then&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(exl,&nbsp;etl,&nbsp;wrapper,&nbsp;unwrapper)&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fold_backward&nbsp;wrap'count&nbsp;([],&nbsp;[],&nbsp;\\&nbsp;e&nbsp;=&gt;&nbsp;e,&nbsp;\\&nbsp;e&nbsp;=&gt;&nbsp;e)&nbsp;xl</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(wrapper</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::APPLY&nbsp;(ncf::CODETEMP&nbsp;fun_var,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::CODETEMP&nbsp;cont_var)&nbsp;.&nbsp;map&nbsp;ncf::CODETEMP&nbsp;exl)),</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::FIX&nbsp;([(ncf::ESCAPE,&nbsp;fun_var,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cont_var&nbsp;.&nbsp;exl,&nbsp;ncf::CNTt&nbsp;.&nbsp;etl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unwrapper&nbsp;fix'n'ysend)],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unitresult))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;we&nbsp;need&nbsp;two&nbsp;rregisters&nbsp;for:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;1.&nbsp;the&nbsp;fate,&nbsp;2.&nbsp;the&nbsp;record&nbsp;holding&nbsp;extra&nbsp;args&nbsp;*/</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;npx&nbsp;=&nbsp;nx&nbsp;+&nbsp;1&nbsp;-&nbsp;maxEscapeArgs</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(pxl,&nbsp;rxl)&nbsp;=&nbsp;firstN&nbsp;(npx,&nbsp;xl)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;=&nbsp;a::make_lambda_variable&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(epxl,&nbsp;eptl,&nbsp;pwrapper,&nbsp;punwrapper)&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fold_backward&nbsp;wrap'rec&nbsp;([],&nbsp;[],&nbsp;\\&nbsp;e&nbsp;=&gt;&nbsp;e,&nbsp;\\&nbsp;e&nbsp;=&gt;&nbsp;e)&nbsp;pxl</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(erxl,&nbsp;ertl,&nbsp;rwrapper,&nbsp;runwrapper)&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fold_backward&nbsp;wrap'count&nbsp;([],&nbsp;[],&nbsp;\\&nbsp;e&nbsp;=&gt;&nbsp;e,&nbsp;\\&nbsp;e&nbsp;=&gt;&nbsp;e)&nbsp;rxl</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(pwrapper</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rwrapper</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::RECORD&nbsp;(a::RK_RECORD,&nbsp;map&nbsp;recvar&nbsp;epxl,&nbsp;v,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::APPLY&nbsp;(ncf::CODETEMP&nbsp;fun_var,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::CODETEMP&nbsp;cont_var)&nbsp;.&nbsp;(ncf::CODETEMP&nbsp;v)&nbsp;.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map&nbsp;ncf::CODETEMP&nbsp;erxl)))),</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::FIX&nbsp;([(ncf::ESCAPE,&nbsp;fun_var,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cont_var&nbsp;.&nbsp;v&nbsp;.&nbsp;erxl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::CNTt&nbsp;.&nbsp;(recty&nbsp;epxl)&nbsp;.&nbsp;ertl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;selectall&nbsp;(v,&nbsp;epxl,&nbsp;eptl,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runwrapper</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(punwrapper&nbsp;fix'n'ysend)))],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unitresult))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newunit&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::ESCAPE,&nbsp;void_var,&nbsp;[cont_var,&nbsp;arg_var],&nbsp;[ncf::CNTt,&nbsp;ncf::bogt],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xrcv)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;replacedcode&nbsp;=&nbsp;mk_yrcv&nbsp;xsend</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;{&nbsp;uheader,&nbsp;curargvar,&nbsp;ul&nbsp;}&nbsp;=&nbsp;units</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newargvar&nbsp;=&nbsp;a::make_lambda_variable&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;uheader'&nbsp;e&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::GET_FIELD&nbsp;(0,&nbsp;ncf::CODETEMP&nbsp;newargvar,&nbsp;curargvar,&nbsp;ncf::bogt,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ncf::GET_FIELD&nbsp;(1,&nbsp;ncf::CODETEMP&nbsp;newargvar,&nbsp;fun_var,&nbsp;ncf::FUNt,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uheader&nbsp;e))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;units'&nbsp;=&nbsp;{&nbsp;uheader&nbsp;=&nbsp;uheader',&nbsp;curargvar&nbsp;=&nbsp;newargvar,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ul&nbsp;=&nbsp;newunit&nbsp;.&nbsp;ul&nbsp;}</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(units',&nbsp;replacedcode)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Deal&nbsp;with&nbsp;one&nbsp;component&nbsp;at&nbsp;a&nbsp;time&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;docomponent&nbsp;((fl,&nbsp;lv,&nbsp;bv),&nbsp;(e,&nbsp;units,&nbsp;lv_rest))&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fv&nbsp;=&nbsp;xcl&nbsp;(bv,&nbsp;lv)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lv'&nbsp;=&nbsp;join&nbsp;(fv,&nbsp;xcl&nbsp;(bv,&nbsp;lv_rest))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xl&nbsp;=&nbsp;fv</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;yl&nbsp;=&nbsp;intersect&nbsp;(bv,&nbsp;lv_rest)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;yl&nbsp;of</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[]&nbsp;=&gt;&nbsp;(e,&nbsp;units,&nbsp;lv_rest)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;_&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;stays&nbsp;(fl,&nbsp;fv)&nbsp;then&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(units,&nbsp;fl)&nbsp;=&nbsp;reconst_comp&nbsp;(fl,&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ncf::FIX&nbsp;(fl,&nbsp;e),&nbsp;units,&nbsp;lv')</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(u,&nbsp;e)&nbsp;=&nbsp;movecomponent&nbsp;(fl,&nbsp;lv,&nbsp;xl,&nbsp;yl,&nbsp;e,&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e,&nbsp;u,&nbsp;lv')</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;now&nbsp;do&nbsp;them&nbsp;all&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fold_forward&nbsp;docomponent&nbsp;(e,&nbsp;units,&nbsp;lv)&nbsp;components</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;split&nbsp;(ncf::ESCAPE,&nbsp;name,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[cont_var,&nbsp;arg_var],&nbsp;&nbsp;[ncf::CNTt,&nbsp;argty],&nbsp;body)&nbsp;=&nbsp;let</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;units&nbsp;=&nbsp;{&nbsp;uheader&nbsp;=&nbsp;\\&nbsp;e&nbsp;=&gt;&nbsp;e,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curargvar&nbsp;=&nbsp;arg_var,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ul&nbsp;=&nbsp;[]&nbsp;}</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tymap&nbsp;=&nbsp;m::add&nbsp;(madd&nbsp;(arg_var,&nbsp;ncf::bogt,&nbsp;m::empty),</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cont_var,&nbsp;CONTTY&nbsp;[ncf::bogt])</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(e,&nbsp;u,&nbsp;_)&nbsp;=&nbsp;reconst&nbsp;(body,&nbsp;tymap,&nbsp;units)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;{&nbsp;uheader,&nbsp;curargvar,&nbsp;ul&nbsp;}&nbsp;=&nbsp;u</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lastunit&nbsp;=&nbsp;(ncf::ESCAPE,&nbsp;name,&nbsp;[cont_var,&nbsp;curargvar],&nbsp;[ncf::CNTt,&nbsp;ncf::bogt],</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uheader&nbsp;e)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fold_forward&nbsp;(op&nbsp;.&nbsp;)&nbsp;[lastunit]&nbsp;ul</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;nextcode_inlining&nbsp;f</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;(split&nbsp;f)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[_,&nbsp;_]&nbsp;=&gt;&nbsp;[f];&nbsp;&nbsp;#&nbsp;&nbsp;found&nbsp;only&nbsp;one&nbsp;extra&nbsp;piece...&nbsp;don't&nbsp;bother&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;l;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;esac;</CODE><BR>
<CODE>end</CODE><BR>
<CODE>*/</CODE><BR><BR><BR>
<CODE>##&nbsp;COPYRIGHT&nbsp;(c)&nbsp;1996&nbsp;Bell&nbsp;Laboratories.</CODE><BR>
<CODE>##&nbsp;Subsequent&nbsp;changes&nbsp;by&nbsp;Jeff&nbsp;Prothero&nbsp;Copyright&nbsp;(c)&nbsp;2010-2015,</CODE><BR>
<CODE>##&nbsp;released&nbsp;per&nbsp;terms&nbsp;of&nbsp;SMLNJ-COPYRIGHT.</CODE><BR>
</P>

<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-src_lib_compiler_back_top_closures_allocprof_pkg.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Codebase__pkg_Files.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-src_lib_compiler_back_top_closures_freemap-unused_pkg.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
