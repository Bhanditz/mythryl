<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>Library Freezing</TITLE>
</HEAD>
<BODY >
<A HREF="my-Call_CC_and_Soft_Thread_Programming.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-The_Full_Monte.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-Overloaded_Operators.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc108">5.4.23</A>  Library Freezing</H3><P>
<A NAME="section:tut:full-monte:library-freezing"></A></P><P>We have <A HREF="my-Multi-file_Projects__Compiling_a_Stand-Alone_Executable.html#section:tut:delving-deeper:compiling-a-stand-alone-executable">seen</A> how to define a Mythryl library and compile it using Mythryl&#X2019;s <TT>make</TT> function.</P><P>Using this approach, each time the <TT>make</TT> command is issued, all source files 
contributing to the library are checked and their last-modified times compared with 
the last-modified time of the library proper; if the compiled library code is 
out of date, the logically minimum amount of recompilation needed is done to 
reconstruct it.</P><P>This is exactly the behavior one wants during development, but scanning the source 
files does take time, and for production deployment of a library, say on an 
embedded Linux box with limited memory, one may not even want to have the source 
code around.</P><P>Mythryl supplies the <TT>freeze</TT> function for such production deployment. 
<I>Freezing</I> a library compiles it into a binary <I>freezefile</I> form in which the source 
code is no longer needed. When the Mythryl <TT>make</TT> command sees such a 
freezefile, it does not even look for the library sourcefiles, or even the 
library <TT>.lib</TT> file.</P><P>Continuing the previous example, here is how we would construct a freezefile 
for it:</P><PRE CLASS="verbatim">    linux$ my

    eval:  make "factor.lib";
        src/app/makelib/main/makelib-g.pkg:   Running   .lib file    factor.lib
          parse/libfile-parser-g.pkg:   Reading   make   file   factor.lib                                            on behalf of &lt;toplevel&gt;
makelib/compilable/thawedlib-tome.pkg:   Parsing   source file   factor.api
makelib/compilable/thawedlib-tome.pkg:   Parsing   source file   factor.pkg
makelib/compilable/thawedlib-tome.pkg:   Parsing   source file   main.pkg
    .../compile/compile-in-dependency-order-g.pkg:   Compiling source file   factor.api                                              to object file   factor.api.compiled
    .../compile/compile-in-dependency-order-g.pkg:   Compiling source file   factor.pkg                                              to object file   factor.pkg.compiled
    .../compile/compile-in-dependency-order-g.pkg:   Compiling source file   main.pkg                                                to object file   main.pkg.compiled
        src/app/makelib/main/makelib-g.pkg:   New names added.

    eval:  freeze "factor.lib";
        src/app/makelib/main/makelib-g.pkg:   Running   .lib file    factor.lib
          parse/libfile-parser-g.pkg:   Reading   make   file   factor.lib                                            on behalf of &lt;toplevel&gt;
    .../compile/compile-in-dependency-order-g.pkg:   Loading                 factor.api
    .../compile/compile-in-dependency-order-g.pkg:   Loading                 factor.pkg
    .../compile/compile-in-dependency-order-g.pkg:   Loading                 main.pkg

       .../freezefile/freezefile-g.pkg:   Creating  library       factor.lib.frozen


    eval:  ^D

    linux$ ls -l
    -rw-r--r-- 1 cynbe cynbe    48 2009-03-09 02:19 factor.api
    -rw-r--r-- 1 cynbe cynbe   283 2009-03-09 02:19 factor.api.compiled
    -rw-r--r-- 1 cynbe cynbe   172 2009-03-09 02:28 factor.lib
    -rw-r--r-- 1 cynbe cynbe  5409 2009-03-12 13:57 factor.lib.frozen
    -rw-r--r-- 1 cynbe cynbe   488 2009-03-09 02:18 factor.pkg
    -rw-r--r-- 1 cynbe cynbe  1107 2009-03-09 02:18 factor.pkg.compiled
    -rw-r--r-- 1 cynbe cynbe  1161 2009-03-09 02:34 main.pkg
    -rw-r--r-- 1 cynbe cynbe  3391 2009-03-09 02:34 main.pkg.compiled
</PRE><P>Here the new <TT>factor.lib.frozen</TT> library archive file logically 
replaces all the other files shown, including the four <TT>.compiled</TT> 
object code files, the <TT>.api</TT> and <TT>.pkg</TT> source files and 
the master <TT>factor.lib</TT> library definition file. All of 
these files may now be removed if desired.</P><P>To load the freezefile into Mythryl you still do <TT>make "factor.lib"</TT> 
but as long as <TT>factor.lib.frozen</TT> exists, <I>makelib</I> does not even 
look for the <TT>factor.lib</TT> file.</P><P>(Of course, as often as not, the factor library is listed as needed by 
some other <TT>.lib</TT> file and is pulled in automatically as part of 
the <TT>make</TT> without explicit mention on your part.)</P><P>To unfreeze the library, just remove the <TT>factor.lib.frozen</TT> file. 
Mythryl&#X2019;s <TT>make</TT> will then revert to its usual behavior of checking 
all sourcefile timestamps and automatically recompiling as needed.</P>

<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-Call_CC_and_Soft_Thread_Programming.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-The_Full_Monte.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-Overloaded_Operators.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
