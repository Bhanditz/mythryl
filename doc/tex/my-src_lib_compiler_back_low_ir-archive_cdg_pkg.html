<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>src/lib/compiler/back/low/ir-archive/cdg.pkg</TITLE>
</HEAD>
<BODY >
<A HREF="my-src_lib_compiler_back_low_intel32_treecode_translate-treecode-to-machcode-intel32-g_pkg.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Codebase__pkg_Files.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-src_lib_compiler_back_low_jmp_no-delay-slots-g_pkg.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc2156">15.4.268</A>  src/lib/compiler/back/low/ir-archive/cdg.pkg</H3><P>
<A NAME="src/lib/compiler/back/low/ir-archive/cdg.pkg"></A>
<CODE>#</CODE><BR>
<CODE>#&nbsp;This&nbsp;is&nbsp;a&nbsp;generic&nbsp;module&nbsp;for&nbsp;computing&nbsp;the&nbsp;control&nbsp;dependence&nbsp;graph</CODE><BR>
<CODE>#&nbsp;from&nbsp;a&nbsp;graph&nbsp;with&nbsp;an&nbsp;entry&nbsp;and&nbsp;an&nbsp;exit.&nbsp;&nbsp;</CODE><BR>
<CODE>#&nbsp;The&nbsp;graph&nbsp;is&nbsp;treated&nbsp;as&nbsp;a&nbsp;control&nbsp;flow&nbsp;graph.&nbsp;&nbsp;</CODE><BR>
<CODE>#&nbsp;The&nbsp;edge&nbsp;predicate&nbsp;is&nbsp;used&nbsp;to&nbsp;determine&nbsp;whether&nbsp;an&nbsp;edge&nbsp;should&nbsp;be</CODE><BR>
<CODE>#&nbsp;treated&nbsp;as&nbsp;a&nbsp;branch&nbsp;edge.</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;--&nbsp;Allen&nbsp;Leung</CODE><BR><BR><BR>
<CODE>###&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"Mostly,&nbsp;when&nbsp;you&nbsp;see&nbsp;programmers,&nbsp;they&nbsp;aren't&nbsp;doing&nbsp;anything.</CODE><BR>
<CODE>###&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;One&nbsp;of&nbsp;the&nbsp;attractive&nbsp;things&nbsp;about&nbsp;programmers&nbsp;is&nbsp;that&nbsp;you</CODE><BR>
<CODE>###&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cannot&nbsp;tell&nbsp;whether&nbsp;or&nbsp;not&nbsp;they&nbsp;are&nbsp;working&nbsp;simply&nbsp;by&nbsp;looking</CODE><BR>
<CODE>###&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;them.</CODE><BR>
<CODE>###</CODE><BR>
<CODE>###&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Very&nbsp;often&nbsp;they're&nbsp;sitting&nbsp;there&nbsp;seemingly&nbsp;drinking&nbsp;coffee&nbsp;and</CODE><BR>
<CODE>###&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gossiping,&nbsp;or&nbsp;just&nbsp;staring&nbsp;into&nbsp;space.&nbsp;What&nbsp;the&nbsp;programmer&nbsp;is</CODE><BR>
<CODE>###&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;trying&nbsp;to&nbsp;do&nbsp;is&nbsp;get&nbsp;a&nbsp;handle&nbsp;on&nbsp;all&nbsp;the&nbsp;individual&nbsp;and&nbsp;unrelated</CODE><BR>
<CODE>###&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ideas&nbsp;that&nbsp;are&nbsp;scampering&nbsp;around&nbsp;in&nbsp;his&nbsp;head."</CODE><BR>
<CODE>###</CODE><BR>
<CODE>###&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Charles&nbsp;M&nbsp;Strauss</CODE><BR><BR><BR>
<CODE>generic&nbsp;package&nbsp;ControlDependenceGraph</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;(package&nbsp;dom:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dominator_Tree</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;meg:&nbsp;&nbsp;Make_Empty_Graph</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;)&nbsp;:&nbsp;CONTROL_DEPENDENCE_GRAPH</CODE><BR><BR>
<CODE>{</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Export&nbsp;to&nbsp;client&nbsp;packages:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;dom&nbsp;=&nbsp;Dom</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;g&nbsp;&nbsp;&nbsp;=&nbsp;graph</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;meg&nbsp;=&nbsp;meg</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;cdg&nbsp;(N,&nbsp;E,&nbsp;G)&nbsp;=&nbsp;graph::graph&nbsp;(N,&nbsp;E,&nbsp;G)&nbsp;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;control_dependence_graph'&nbsp;f_node&nbsp;f_edge&nbsp;f_graph&nbsp;is_conditional</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(PDom&nbsp;as&nbsp;g::GRAPH&nbsp;pdom)&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;my&nbsp;g::GRAPH&nbsp;mcg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Dom::mcg&nbsp;PDom</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;N&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;mcg.capacity&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cdg_info&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;f_graph&nbsp;mcg.graph_info</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;CDG&nbsp;as&nbsp;g::GRAPH&nbsp;cdg&nbsp;=&nbsp;gi::graph("CDG",&nbsp;cdg_info,&nbsp;N)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ipdom&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;Dom::idom&nbsp;PDom</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add_edge&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;\\&nbsp;e&nbsp;=&gt;&nbsp;cdg.add_edge&nbsp;(f_edge&nbsp;e)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out_edges&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;mcg.out_edges</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Create&nbsp;the&nbsp;control&nbsp;dependence&nbsp;nodes&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mcg.forall_nodes&nbsp;(\\&nbsp;n&nbsp;=&gt;&nbsp;cdg.add_node&nbsp;(f_node&nbsp;n))</CODE><BR>
<CODE>&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Create&nbsp;the&nbsp;control&nbsp;dependence&nbsp;edges&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mcg.forall_nodes&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\\&nbsp;node&nbsp;as&nbsp;(X,&nbsp;bb)&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;ipdom_X&nbsp;=&nbsp;ipdom&nbsp;X</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;loop&nbsp;(X,&nbsp;Z,&nbsp;L)&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;ipdom_X&nbsp;==&nbsp;-1&nbsp;or&nbsp;ipdom_X&nbsp;!=&nbsp;Z&nbsp;then</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Z&nbsp;is&nbsp;immediately&nbsp;control&nbsp;dependent&nbsp;on&nbsp;X&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(add_edge&nbsp;(X,&nbsp;Z,&nbsp;L);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;ipdom&nbsp;Z&nbsp;of</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-1&nbsp;=&gt;&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;&nbsp;Z&nbsp;=&gt;&nbsp;loop&nbsp;(X,&nbsp;Z,&nbsp;L))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;apply&nbsp;(\\&nbsp;(X,&nbsp;Z,&nbsp;L)&nbsp;=&gt;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Z&nbsp;is&nbsp;a&nbsp;successor&nbsp;of&nbsp;X&nbsp;on&nbsp;label&nbsp;L&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;is_conditional&nbsp;L&nbsp;then&nbsp;loop&nbsp;(X,&nbsp;Z,&nbsp;L)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;(out_edges&nbsp;X)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CDG</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;control_dependence_graph&nbsp;is_conditional&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;control_dependence_graph'&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\\&nbsp;n&nbsp;=&gt;&nbsp;n)&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\\&nbsp;e&nbsp;=&gt;&nbsp;e)&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(\\&nbsp;g&nbsp;=&gt;&nbsp;g)&nbsp;is_conditional</CODE><BR><BR>
<CODE>}</CODE><BR>
</P>

<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-src_lib_compiler_back_low_intel32_treecode_translate-treecode-to-machcode-intel32-g_pkg.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Codebase__pkg_Files.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-src_lib_compiler_back_low_jmp_no-delay-slots-g_pkg.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
