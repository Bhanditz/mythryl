<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>src/lib/tk/src/com.pkg</TITLE>
</HEAD>
<BODY >
<A HREF="my-src_lib_tk_src_com-state_pkg.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Codebase__pkg_Files.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-src_lib_tk_src_config_pkg.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc3166">15.4.1278</A>  src/lib/tk/src/com.pkg</H3><P>
<A NAME="src/lib/tk/src/com.pkg"></A>
<CODE>##&nbsp;com.pkg</CODE><BR>
<CODE>##&nbsp;Author:&nbsp;bu/stefan&nbsp;(Last&nbsp;modification&nbsp;$Author:&nbsp;2cxl&nbsp;$)</CODE><BR>
<CODE>##&nbsp;(C)&nbsp;1996-99,&nbsp;Bremen&nbsp;Institute&nbsp;for&nbsp;Safe&nbsp;Systems,&nbsp;Universitaet&nbsp;Bremen</CODE><BR><BR>
<CODE>#&nbsp;Compiled&nbsp;by:</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_tk_src_tk_sublib.html#src/lib/tk/src/tk.sublib"><TT>src/lib/tk/src/tk.sublib</TT></A><BR><BR><BR><BR><BR><CODE>#&nbsp;***************************************************************************</CODE><BR>
<CODE>#&nbsp;Basic&nbsp;communication&nbsp;layer:&nbsp;sending&nbsp;&amp;&nbsp;receiving,</CODE><BR>
<CODE>#&nbsp;sending&nbsp;commands&nbsp;and&nbsp;receiving&nbsp;events,&nbsp;main&nbsp;loop&nbsp;and&nbsp;control.&nbsp;</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;This&nbsp;module&nbsp;implements&nbsp;the&nbsp;tk&nbsp;event&nbsp;handling&nbsp;mechanism&nbsp;--&nbsp;i.e.&nbsp;</CODE><BR>
<CODE>#&nbsp;the&nbsp;bit&nbsp;which&nbsp;listens&nbsp;to&nbsp;something&nbsp;coming&nbsp;from&nbsp;Tcl,&nbsp;figures&nbsp;out&nbsp;which</CODE><BR>
<CODE>#&nbsp;naming&nbsp;this&nbsp;corresponds&nbsp;to,&nbsp;and&nbsp;calls&nbsp;the&nbsp;corresponding&nbsp;Mythryl&nbsp;function.</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;In&nbsp;event-loop.pkg&nbsp;we&nbsp;have&nbsp;two&nbsp;main&nbsp;functions,&nbsp;interpret_event:&nbsp;String-&gt;&nbsp;Void</CODE><BR>
<CODE>#&nbsp;which&nbsp;takes&nbsp;a&nbsp;string&nbsp;returned&nbsp;by&nbsp;the&nbsp;wish&nbsp;and&nbsp;figures&nbsp;out&nbsp;what&nbsp;to</CODE><BR>
<CODE>#&nbsp;do&nbsp;with&nbsp;it,&nbsp;and&nbsp;appLoop:&nbsp;Void-&gt;&nbsp;Void&nbsp;which&nbsp;is&nbsp;the&nbsp;main&nbsp;event&nbsp;loop,</CODE><BR>
<CODE>#&nbsp;which&nbsp;listens&nbsp;to&nbsp;the&nbsp;pipes&nbsp;to&nbsp;all&nbsp;currently&nbsp;running&nbsp;applications,</CODE><BR>
<CODE>#&nbsp;reads&nbsp;their&nbsp;answer,&nbsp;dispatches&nbsp;their&nbsp;handling,&nbsp;and&nbsp;most&nbsp;importantly</CODE><BR>
<CODE>#&nbsp;loops&nbsp;(hence&nbsp;the&nbsp;name).</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;(Probably,&nbsp;these&nbsp;two&nbsp;functions&nbsp;should&nbsp;not&nbsp;be&nbsp;in&nbsp;the&nbsp;same&nbsp;module).</CODE><BR>
<CODE>#&nbsp;&nbsp;</CODE><BR>
<CODE>#&nbsp;$Date:&nbsp;2001/03/30&nbsp;13:39:05&nbsp;$</CODE><BR>
<CODE>#&nbsp;$Revision:&nbsp;3.0&nbsp;$</CODE><BR>
<CODE>#&nbsp;</CODE><BR>
<CODE>#&nbsp;**************************************************************************</CODE><BR><BR><BR><BR>
<CODE>package&nbsp;&nbsp;&nbsp;com</CODE><BR>
<CODE>:&nbsp;(weak)&nbsp;&nbsp;Com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Com&nbsp;&nbsp;&nbsp;is&nbsp;from&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_tk_src_com_api.html#src/lib/tk/src/com.api"><TT>src/lib/tk/src/com.api</TT></A><BR><CODE>{</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;package&nbsp;&nbsp;&nbsp;basic_tk_types;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;package&nbsp;&nbsp;&nbsp;basic_utilities;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;package&nbsp;&nbsp;&nbsp;com_state;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;package&nbsp;&nbsp;&nbsp;gui_state;</CODE><BR><BR>
<CODE>#&nbsp;**********************************************************************</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;WRITING&nbsp;AND&nbsp;READING</CODE><BR>
<CODE>#</CODE><BR><BR><BR>
<CODE>#&nbsp;&nbsp;get_line()&nbsp;strings&nbsp;can&nbsp;only&nbsp;be&nbsp;used&nbsp;for&nbsp;texts&nbsp;that&nbsp;are&nbsp;certain&nbsp;not&nbsp;</CODE><BR>
<CODE>#&nbsp;&nbsp;to&nbsp;contain&nbsp;\n.&nbsp;Otherwise,&nbsp;get_line_m()&nbsp;(M&nbsp;for&nbsp;multiple)&nbsp;has&nbsp;to&nbsp;be&nbsp;used.</CODE><BR>
<CODE>#&nbsp;&nbsp;On&nbsp;the&nbsp;other&nbsp;side,&nbsp;an&nbsp;appropriate&nbsp;writeM&nbsp;is&nbsp;provided.&nbsp;</CODE><BR><BR><BR>
<CODE>fun&nbsp;do_prot_in&nbsp;t</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;(get_wish_prot())</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THE&nbsp;prot</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;file::write&nbsp;(prot,&nbsp;"&lt;==&nbsp;"&nbsp;+&nbsp;t&nbsp;+&nbsp;"\n");</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file::flush&nbsp;prot;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL&nbsp;=&gt;&nbsp;t;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;esac;</CODE><BR><BR>
<CODE>fun&nbsp;get_line&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;{</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;com_state::get_event&nbsp;();</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Strip&nbsp;off&nbsp;concluding&nbsp;"\n":</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;substring&nbsp;(t,&nbsp;0,&nbsp;(size&nbsp;t)&nbsp;-1);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do_prot_in&nbsp;t;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;</CODE><BR>
<CODE>fun&nbsp;get_line_m&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;fun&nbsp;getls&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;t&nbsp;=&nbsp;com_state::get_event();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&nbsp;&nbsp;(t&nbsp;==&nbsp;"EOM\n"&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;&nbsp;"";</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;t&nbsp;+&nbsp;getls&nbsp;();&nbsp;&nbsp;&nbsp;fi;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do_prot_in&nbsp;(getls());</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR><BR>
<CODE>fun&nbsp;put_line&nbsp;ps</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;case&nbsp;(get_wish_prot())</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THE&nbsp;prot</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;file::write&nbsp;(prot,&nbsp;"===&gt;&nbsp;"&nbsp;+&nbsp;ps&nbsp;+&nbsp;"\n");</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;file::flush&nbsp;prot;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL&nbsp;=&gt;&nbsp;();</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;esac;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com_state::eval&nbsp;&nbsp;ps;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR><BR>
<CODE>#&nbsp;**********************************************************************;</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;SENDING&nbsp;COMMANDS</CODE><BR>
<CODE>#</CODE><BR><BR><BR><BR>
<CODE>fun&nbsp;put_tcl_cmd&nbsp;cmd</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;emsg&nbsp;=&nbsp;&nbsp;\\&nbsp;s&nbsp;=&nbsp;&nbsp;(string::join&nbsp;"&nbsp;"&nbsp;s);</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;get_answer&nbsp;aws</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;get_line();&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ss&nbsp;&nbsp;&nbsp;=&nbsp;string_util::words&nbsp;a;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug::print&nbsp;1&nbsp;("com::putTclCmd:&nbsp;got&nbsp;\""&nbsp;+&nbsp;a&nbsp;+&nbsp;"\"");</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kind&nbsp;=&nbsp;hd&nbsp;ss;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&nbsp;&nbsp;(kind&nbsp;==&nbsp;"CMDOK"</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;&nbsp;&nbsp;&nbsp;kind&nbsp;==&nbsp;"ERROR"</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(a,&nbsp;aws);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_answer&nbsp;(aws&nbsp;@&nbsp;[a]);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;put_line&nbsp;("WriteCmd&nbsp;\"CMDOK\"&nbsp;{"&nbsp;+&nbsp;cmd&nbsp;+&nbsp;"}");</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(a,&nbsp;binds)&nbsp;=&nbsp;get_answer&nbsp;[];</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gaws&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;com_state::get_tcl_answers_gui();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com_state::upd_tcl_answers_gui&nbsp;(gaws@binds);</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(not&nbsp;(length&nbsp;binds&nbsp;==&nbsp;0))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug::print&nbsp;1&nbsp;"Missed&nbsp;Naming";</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;(hd&nbsp;(string_util::words&nbsp;a))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"CMDOK"&nbsp;=&gt;&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"ERROR"&nbsp;=&gt;&nbsp;debug::warning&nbsp;("com::putCmd:&nbsp;got&nbsp;Tcl&nbsp;Error:&nbsp;\""&nbsp;+&nbsp;a&nbsp;+&nbsp;"\"");</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;debug::warning&nbsp;("com::putCmd:&nbsp;got&nbsp;unexpected&nbsp;answer:&nbsp;\""&nbsp;+&nbsp;s&nbsp;+&nbsp;"\"");</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;esac;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;}</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;except</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EMPTY&nbsp;=&gt;&nbsp;debug::warning&nbsp;("com::putCmd:&nbsp;no&nbsp;answer");&nbsp;end&nbsp;;</CODE><BR><BR><BR>
<CODE>fun&nbsp;read_tcl_val&nbsp;req</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;join_sp&nbsp;=&nbsp;string::join&nbsp;"&nbsp;";</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;get_answer&nbsp;aws</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;a&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;get_line&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ss&nbsp;&nbsp;&nbsp;=&nbsp;string_util::words&nbsp;a;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kind&nbsp;=&nbsp;hd&nbsp;ss;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;debug::print&nbsp;1&nbsp;("com::readTclVal:&nbsp;got&nbsp;\""&nbsp;+&nbsp;a&nbsp;+&nbsp;"\"");</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(kind&nbsp;==&nbsp;"VValue")&nbsp;&nbsp;&nbsp;(join_sp&nbsp;(tl&nbsp;(ss)),&nbsp;aws);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_answer&nbsp;(aws&nbsp;@&nbsp;[a]);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;put_line&nbsp;("WriteSec&nbsp;\"VValue\"&nbsp;{"&nbsp;+&nbsp;req&nbsp;+&nbsp;"}");&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(a,&nbsp;binds)&nbsp;=&nbsp;get_answer&nbsp;[];</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gaws&nbsp;=&nbsp;com_state::get_tcl_answers_gui();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com_state::upd_tcl_answers_gui&nbsp;(gaws@binds);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>fun&nbsp;read_answer_from_tcl&nbsp;interpret_answer</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;(com_state::get_tcl_answers_gui&nbsp;())</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ta&nbsp;.&nbsp;tal)&nbsp;=&gt;&nbsp;{&nbsp;com_state::upd_tcl_answers_gui&nbsp;(tal);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interpret_answer&nbsp;ta;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_answer_from_tcl&nbsp;interpret_answer;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;esac;</CODE><BR><BR>
<CODE>#&nbsp;&nbsp;forceTcl2doOneEvent&nbsp;=&nbsp;com_state::do_one_event_without_waiting&nbsp;</CODE><BR><BR><BR>
<CODE>#&nbsp;&nbsp;"communicate"&nbsp;</CODE><BR><BR>
<CODE>comm_to_tcl&nbsp;&nbsp;&nbsp;=&nbsp;"Write";</CODE><BR>
<CODE>comm_to_tcl'&nbsp;&nbsp;=&nbsp;"SWrite";</CODE><BR>
<CODE>write_to_tcl&nbsp;&nbsp;=&nbsp;"Write";</CODE><BR>
<CODE>write_mto_tcl&nbsp;=&nbsp;"WriteM";</CODE><BR><BR><BR><BR>
<CODE>#&nbsp;**********************************************************************</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;MAIN&nbsp;CONTROL</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;Setting&nbsp;up&nbsp;the&nbsp;communication.</CODE><BR><BR><BR><BR>
<CODE>fun&nbsp;reset_tcl&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;gui_state::init_gui_state();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;com_state::init_com_state();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>fun&nbsp;init_tcl&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;com_state::init_wish();</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;put_line&nbsp;((get_tcl_init())&nbsp;+&nbsp;prelude_tcl);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>fun&nbsp;exit_tcl&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;put_line&nbsp;"destroy&nbsp;.";</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close_wish&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;init_gui_state&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;init_com_state&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>};</CODE><BR><BR>
</P>

<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-src_lib_tk_src_com-state_pkg.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Codebase__pkg_Files.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-src_lib_tk_src_config_pkg.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
