<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>src/lib/tk/src/live_text.pkg</TITLE>
</HEAD>
<BODY >
<A HREF="my-src_lib_tk_src_gui_state_pkg.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Codebase__pkg_Files.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-src_lib_tk_src_mark_pkg.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc3175">15.4.1287</A>  src/lib/tk/src/live_text.pkg</H3><P>
<A NAME="src/lib/tk/src/live_text.pkg"></A>
<CODE>/*&nbsp;***************************************************************************</CODE><BR>
<CODE>&nbsp;</CODE><BR>
<CODE>#&nbsp;Compiled&nbsp;by:</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_tk_src_tk_sublib.html#src/lib/tk/src/tk.sublib"><TT>src/lib/tk/src/tk.sublib</TT></A><BR><BR><CODE>&nbsp;&nbsp;&nbsp;Annotated&nbsp;texts&nbsp;for&nbsp;the&nbsp;tk&nbsp;markup&nbsp;language.</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;$Date:&nbsp;2001/03/30&nbsp;13:38:57&nbsp;$</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;$Revision:&nbsp;3.0&nbsp;$</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;Author:&nbsp;cxl&nbsp;(Last&nbsp;modification&nbsp;by&nbsp;$Author:&nbsp;2cxl&nbsp;$)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;(C)&nbsp;1996,&nbsp;1998,&nbsp;Bremen&nbsp;Institute&nbsp;for&nbsp;Safe&nbsp;Systems,&nbsp;Universitaet&nbsp;Bremen</CODE><BR>
<CODE>&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;**************************************************************************&nbsp;*/</CODE><BR><BR>
<CODE>package&nbsp;&nbsp;&nbsp;live_text</CODE><BR>
<CODE>:&nbsp;(weak)&nbsp;&nbsp;Live_Text&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Live_Text&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;from&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_tk_src_live_text_api.html#src/lib/tk/src/live_text.api"><TT>src/lib/tk/src/live_text.api</TT></A><BR><CODE>{</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;infix&nbsp;my&nbsp;70&nbsp;&nbsp;+++&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;See&nbsp;below&nbsp;--&nbsp;fixity&nbsp;decl's&nbsp;not&nbsp;allowed&nbsp;inside&nbsp;APIs&nbsp;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;package&nbsp;&nbsp;&nbsp;basic_tk_types;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;package&nbsp;&nbsp;&nbsp;basic_utilities;</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;two&nbsp;int's&nbsp;are&nbsp;the&nbsp;index&nbsp;to&nbsp;the&nbsp;last&nbsp;character/last&nbsp;row&nbsp;of&nbsp;the&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;text.&nbsp;This&nbsp;index&nbsp;is&nbsp;calculated&nbsp;`lazily':&nbsp;If&nbsp;it&nbsp;is&nbsp;not&nbsp;given&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;explicitly,&nbsp;it&nbsp;is&nbsp;only&nbsp;calculated&nbsp;if&nbsp;another&nbsp;annotated&nbsp;text&nbsp;with</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;a&nbsp;non-empty&nbsp;list&nbsp;of&nbsp;annotations&nbsp;is&nbsp;appended&nbsp;to&nbsp;the&nbsp;text.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;get_livetext_text&nbsp;(LIVE_TEXT&nbsp;{&nbsp;str,&nbsp;...&nbsp;}&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;get_livetext_text_items&nbsp;(LIVE_TEXT&nbsp;{&nbsp;text_items,&nbsp;...&nbsp;}&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text_items;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;update_livetext_text_items&nbsp;(LIVE_TEXT&nbsp;{&nbsp;len=&gt;x,&nbsp;str=&gt;t,&nbsp;...&nbsp;}&nbsp;)&nbsp;a</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIVE_TEXT&nbsp;{&nbsp;len=&gt;x,&nbsp;str=&gt;t,&nbsp;text_items=&gt;a&nbsp;};</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Adding&nbsp;rows&nbsp;--&nbsp;a&nbsp;wee&nbsp;bit&nbsp;funny,&nbsp;since&nbsp;counting&nbsp;starts&nbsp;at&nbsp;one</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;but&nbsp;we&nbsp;want&nbsp;to&nbsp;be&nbsp;graceful&nbsp;about&nbsp;line&nbsp;zero&nbsp;as&nbsp;well.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;add_rows&nbsp;(r1,&nbsp;r2)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r1+&nbsp;r2-&nbsp;(int::min&nbsp;(r1,&nbsp;1));</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;add2mark&nbsp;(r,&nbsp;c)&nbsp;(MARK&nbsp;(rm,&nbsp;cm))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;&nbsp;&nbsp;(rm&nbsp;&lt;=&nbsp;1&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;&nbsp;MARK&nbsp;(r,&nbsp;c+cm);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;MARK&nbsp;(add_rows&nbsp;(r,&nbsp;rm),&nbsp;cm);&nbsp;&nbsp;&nbsp;fi;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add2mark&nbsp;(r,&nbsp;c)&nbsp;(MARK_TO_END&nbsp;rm)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MARK_TO_END&nbsp;(add_rows&nbsp;(r,&nbsp;rm));</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;add2mark&nbsp;(r,&nbsp;c)&nbsp;MARK_END</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;MARK_END;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;A&nbsp;wee&nbsp;bit&nbsp;debatable--&nbsp;we&nbsp;might&nbsp;want&nbsp;to&nbsp;adjust&nbsp;the&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;"End"&nbsp;etc.&nbsp;marks&nbsp;in&nbsp;the&nbsp;text_items&nbsp;of&nbsp;the&nbsp;first</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;text.&nbsp;Then&nbsp;again,&nbsp;end&nbsp;means&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;pair&nbsp;f&nbsp;(x,&nbsp;y)&nbsp;=&nbsp;(f&nbsp;x,&nbsp;f&nbsp;y);&nbsp;&nbsp;#&nbsp;&nbsp;has&nbsp;gone&nbsp;into&nbsp;basic_utilities&nbsp;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;map_mark&nbsp;f&nbsp;(TEXT_ITEM_TAG&nbsp;{&nbsp;text_item_id,&nbsp;marks,&nbsp;traits,&nbsp;event_callbacks&nbsp;}&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_ITEM_TAG&nbsp;{&nbsp;text_item_id,&nbsp;marks=&gt;map&nbsp;(pair&nbsp;f)&nbsp;marks,&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;traits,&nbsp;event_callbacks&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map_mark&nbsp;f&nbsp;(TEXT_ITEM_WIDGET&nbsp;{&nbsp;text_item_id,&nbsp;mark,&nbsp;subwidgets,&nbsp;traits,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event_callbacks&nbsp;}&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TEXT_ITEM_WIDGET&nbsp;{&nbsp;text_item_id,&nbsp;mark=&gt;f&nbsp;mark,&nbsp;subwidgets,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;traits,&nbsp;event_callbacks&nbsp;};&nbsp;end;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Concatenate&nbsp;two&nbsp;annotated&nbsp;texts&nbsp;with&nbsp;explicit&nbsp;length:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;cat&nbsp;((rows,&nbsp;cols),&nbsp;s,&nbsp;a)&nbsp;((rows0,&nbsp;cols0),&nbsp;t,&nbsp;b)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;ann&nbsp;=&nbsp;a@(map&nbsp;(map_mark&nbsp;(add2mark&nbsp;(rows,&nbsp;cols)))&nbsp;b);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(rows0&nbsp;&lt;=&nbsp;1)&nbsp;#&nbsp;&nbsp;second&nbsp;text&nbsp;only&nbsp;has&nbsp;one&nbsp;line,&nbsp;we&nbsp;only&nbsp;add&nbsp;cols&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIVE_TEXT&nbsp;{&nbsp;len=&gt;THE&nbsp;(rows,&nbsp;cols+cols0),&nbsp;str=&gt;s$t,&nbsp;text_items=&gt;ann&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;LIVE_TEXT&nbsp;{&nbsp;len=&gt;THE&nbsp;(add_rows&nbsp;(rows,&nbsp;rows0),&nbsp;cols0),&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;str=&gt;s$t,&nbsp;text_items=&gt;ann&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Count&nbsp;length&nbsp;of&nbsp;annotated&nbsp;text&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;livetext_length&nbsp;t</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;fun&nbsp;count&nbsp;(thischar,&nbsp;(line,&nbsp;char))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(string_util::is_linefeed&nbsp;thischar)&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(line+1,&nbsp;0);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;(line,&nbsp;char+1);&nbsp;fi;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my&nbsp;(rows,&nbsp;cols)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substring::fold_forward&nbsp;count&nbsp;(1,&nbsp;0)&nbsp;(substring::from_string&nbsp;t);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(int::max&nbsp;(rows,&nbsp;1),&nbsp;cols);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;get_livetext_rows_cols&nbsp;(LIVE_TEXT&nbsp;{&nbsp;len=&gt;THE&nbsp;(r,&nbsp;c),&nbsp;...&nbsp;}&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;rows=&gt;&nbsp;r,&nbsp;cols=&gt;&nbsp;c&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_livetext_rows_cols&nbsp;(LIVE_TEXT&nbsp;{&nbsp;len=&gt;NULL,&nbsp;str=&gt;t,&nbsp;...&nbsp;}&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;my&nbsp;(r,&nbsp;c)=&nbsp;livetext_length&nbsp;t;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;rows=&gt;&nbsp;r,&nbsp;cols=&gt;&nbsp;c&nbsp;};&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;(&nbsp;(LIVE_TEXT&nbsp;{&nbsp;len=&gt;NULL,&nbsp;str=&gt;s,&nbsp;text_items&nbsp;=&gt;&nbsp;a&nbsp;&nbsp;}&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+++&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(LIVE_TEXT&nbsp;{&nbsp;len=&gt;NULL,&nbsp;str=&gt;t,&nbsp;text_items&nbsp;=&gt;&nbsp;[]&nbsp;}&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(LIVE_TEXT&nbsp;{&nbsp;len=&gt;NULL,&nbsp;str=&gt;s$t,&nbsp;text_items=&gt;a&nbsp;}&nbsp;);&nbsp;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;(LIVE_TEXT&nbsp;{&nbsp;len=&gt;len1,&nbsp;str=&gt;s,&nbsp;text_items=&gt;a&nbsp;}&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+++&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(LIVE_TEXT&nbsp;{&nbsp;len=&gt;len2,&nbsp;str=&gt;t,&nbsp;text_items=&gt;b&nbsp;}&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;fun&nbsp;get_len&nbsp;(THE&nbsp;(r,&nbsp;c),&nbsp;s,&nbsp;a)&nbsp;=&gt;&nbsp;&nbsp;((r,&nbsp;c),&nbsp;s,&nbsp;a);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;get_len&nbsp;(NULL,&nbsp;s,&nbsp;a)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(livetext_length&nbsp;s,&nbsp;s,&nbsp;a);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cat&nbsp;(get_len&nbsp;(len1,&nbsp;s,&nbsp;a))&nbsp;(get_len&nbsp;(len2,&nbsp;t,&nbsp;b));</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;nl&nbsp;(LIVE_TEXT&nbsp;{&nbsp;len=&gt;NULL,&nbsp;str=&gt;s,&nbsp;text_items=&gt;a&nbsp;}&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIVE_TEXT&nbsp;{&nbsp;len=&gt;NULL,&nbsp;str=&gt;s$"\n",&nbsp;text_items=&gt;a&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nl&nbsp;(LIVE_TEXT&nbsp;{&nbsp;len=&gt;THE&nbsp;(r,&nbsp;c),&nbsp;str=&gt;s,&nbsp;text_items=&gt;a&nbsp;}&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIVE_TEXT&nbsp;{&nbsp;len=&gt;THE&nbsp;(r+1,&nbsp;0),&nbsp;str=&gt;s$"\n",&nbsp;text_items=&gt;a&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;empty_livetext</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIVE_TEXT&nbsp;{&nbsp;len=&gt;NULL,&nbsp;str=&gt;"",&nbsp;text_items&nbsp;=&gt;&nbsp;[]&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;adjust_marks&nbsp;{&nbsp;rows,&nbsp;cols&nbsp;}&nbsp;annos</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map&nbsp;&nbsp;(map_mark&nbsp;(add2mark&nbsp;(rows,&nbsp;cols)))&nbsp;&nbsp;annos;</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Convert&nbsp;a&nbsp;string&nbsp;to&nbsp;an&nbsp;annotated&nbsp;text&nbsp;with&nbsp;no&nbsp;text_items&nbsp;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;make&nbsp;str</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LIVE_TEXT&nbsp;{&nbsp;len=&gt;NULL,&nbsp;str,&nbsp;text_items&nbsp;=&gt;&nbsp;[]&nbsp;};</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;livetext_join&nbsp;str&nbsp;ls</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;join'&nbsp;ls</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at&nbsp;=&nbsp;make&nbsp;str;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;join'&nbsp;[]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;empty_livetext;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;join'&nbsp;[t]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;t;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;join'&nbsp;(t&nbsp;.&nbsp;ts)&nbsp;=&gt;&nbsp;&nbsp;at&nbsp;+++&nbsp;at&nbsp;+++&nbsp;(join'&nbsp;ts);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR><BR>
<CODE>};</CODE><BR><BR>
</P>

<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-src_lib_tk_src_gui_state_pkg.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Codebase__pkg_Files.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-src_lib_tk_src_mark_pkg.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
