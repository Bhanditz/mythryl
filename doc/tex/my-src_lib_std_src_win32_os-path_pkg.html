<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>src/lib/std/src/win32/os-path.pkg</TITLE>
</HEAD>
<BODY >
<A HREF="my-src_lib_std_src_win32_os-file-system_pkg.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Codebase__pkg_Files.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-src_lib_std_src_win32_os-process_pkg.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc3130">15.4.1242</A>  src/lib/std/src/win32/os-path.pkg</H3><P>
<A NAME="src/lib/std/src/win32/os-path.pkg"></A>
<CODE>##&nbsp;os-path.pkg</CODE><BR><BR><BR><BR>
<CODE>#&nbsp;Win32&nbsp;implementation&nbsp;of&nbsp;the&nbsp;winix__premicrothread::path&nbsp;package.</CODE><BR><BR><BR><BR>
<CODE>local</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;string&nbsp;=&nbsp;StringImp</CODE><BR>
<CODE>in</CODE><BR>
<CODE>package&nbsp;winix_path&nbsp;=&nbsp;winix_path_g&nbsp;(</CODE><BR>
<CODE>&nbsp;&nbsp;package&nbsp;{</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;W32G&nbsp;=&nbsp;win32_general</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;c&nbsp;=&nbsp;char</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;s&nbsp;=&nbsp;string</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;ss&nbsp;=&nbsp;substring</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exception&nbsp;PATH</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enum&nbsp;arc_kind&nbsp;=&nbsp;Null&nbsp;</CODE><CODE>|&nbsp;Parent&nbsp;|&nbsp;Current&nbsp;|&nbsp;Arc&nbsp;of&nbsp;String</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;ilkify&nbsp;""&nbsp;=&nbsp;Null</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ilkify&nbsp;"."&nbsp;=&nbsp;Current</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ilkify&nbsp;".."&nbsp;=&nbsp;Parent</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;ilkify&nbsp;a&nbsp;=&nbsp;Arc&nbsp;a</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;parent_arc&nbsp;&nbsp;=&nbsp;".."</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;current_arc&nbsp;=&nbsp;"."</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;volSepChar&nbsp;=&nbsp;':'</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arcSepChar&nbsp;=&nbsp;W32G::arcSepChar</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arcSep&nbsp;=&nbsp;s::str&nbsp;arcSepChar</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;volPresent&nbsp;disk_volume&nbsp;=&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(string::size&nbsp;disk_volume&nbsp;&gt;=&nbsp;2)&nbsp;and</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(c::is_alpha&nbsp;(s::sub&nbsp;(disk_volume,&nbsp;0))&nbsp;and&nbsp;(s::sub&nbsp;(disk_volume,&nbsp;1)&nbsp;=&nbsp;volSepChar))</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;volume_is_valid&nbsp;(_,&nbsp;disk_volume)&nbsp;=&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ss::is_empty&nbsp;disk_volume)&nbsp;or&nbsp;volPresent&nbsp;(ss::string&nbsp;disk_volume)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emptySS&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;ss::from_string&nbsp;""</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;splitPath&nbsp;(disk_volume,&nbsp;s)&nbsp;=&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ss::size&nbsp;s&nbsp;&gt;=&nbsp;1)&nbsp;and&nbsp;(ss::sub&nbsp;(s,&nbsp;0)&nbsp;==&nbsp;arcSepChar)&nbsp;then</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(TRUE,&nbsp;disk_volume,&nbsp;ss::drop_first&nbsp;1&nbsp;s)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;(FALSE,&nbsp;disk_volume,&nbsp;s)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;splitVolPath&nbsp;""&nbsp;=&nbsp;(FALSE,&nbsp;emptySS,&nbsp;emptySS)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;splitVolPath&nbsp;s&nbsp;=&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;volPresent&nbsp;s&nbsp;then&nbsp;splitPath&nbsp;(ss::split_at&nbsp;(ss::from_string&nbsp;s,&nbsp;2))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;splitPath&nbsp;(emptySS,&nbsp;ss::from_string&nbsp;s)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;joinVolPath&nbsp;arg&nbsp;=&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;fun&nbsp;checkVolume&nbsp;disk_volume&nbsp;=&nbsp;if&nbsp;(volPresent&nbsp;disk_volume)&nbsp;then&nbsp;disk_volume&nbsp;else&nbsp;raise&nbsp;exception&nbsp;Path</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;aux&nbsp;(TRUE,&nbsp;"",&nbsp;"")&nbsp;=&nbsp;arcSep</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;aux&nbsp;(TRUE,&nbsp;"",&nbsp;s)&nbsp;=&nbsp;arcSep$s</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;aux&nbsp;(TRUE,&nbsp;disk_volume,&nbsp;"")&nbsp;=&nbsp;(checkVolume&nbsp;disk_volume)$arcSep</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;aux&nbsp;(TRUE,&nbsp;disk_volume,&nbsp;s)&nbsp;=&nbsp;(checkVolume&nbsp;disk_volume)$arcSep$s</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;aux&nbsp;(FALSE,&nbsp;"",&nbsp;s)&nbsp;=&nbsp;s</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;aux&nbsp;(FALSE,&nbsp;disk_volume,&nbsp;"")&nbsp;=&nbsp;checkVolume&nbsp;disk_volume</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><CODE>|&nbsp;aux&nbsp;(FALSE,&nbsp;disk_volume,&nbsp;s)&nbsp;=&nbsp;(checkVolume&nbsp;disk_volume)$s</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;&nbsp;aux&nbsp;arg</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;sameVol&nbsp;(v1,&nbsp;v2)&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;DiskVolume&nbsp;names&nbsp;are&nbsp;case-insensitive&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v1&nbsp;=&nbsp;v2&nbsp;or</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string::map&nbsp;char::to_lower&nbsp;v1&nbsp;=&nbsp;string::map&nbsp;char::to_lower&nbsp;v2</CODE><BR>
<CODE>&nbsp;&nbsp;});</CODE><BR>
<CODE>end</CODE><BR><BR><BR>
<CODE>##&nbsp;COPYRIGHT&nbsp;(c)&nbsp;1996&nbsp;Bell&nbsp;Laboratories.</CODE><BR>
<CODE>##&nbsp;Subsequent&nbsp;changes&nbsp;by&nbsp;Jeff&nbsp;Prothero&nbsp;Copyright&nbsp;(c)&nbsp;2010-2015,</CODE><BR>
<CODE>##&nbsp;released&nbsp;per&nbsp;terms&nbsp;of&nbsp;SMLNJ-COPYRIGHT.</CODE><BR>
</P>

<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-src_lib_std_src_win32_os-file-system_pkg.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Codebase__pkg_Files.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-src_lib_std_src_win32_os-process_pkg.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
