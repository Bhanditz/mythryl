<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>Mythryl Functions: Value Capture</TITLE>
</HEAD>
<BODY >
<A HREF="my-Mythryl_Functions__List_Handling_Idioms.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-The_Full_Monte.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-Mythryl_Functions__Currying_and_Partial_Application.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc90">5.4.5</A>  Mythryl Functions: Value Capture</H3><BLOCKQUOTE CLASS="quote"><FONT SIZE=1>
&#X201C;You are full of surprises, Mr Baggins!.&#X201D;<BR>
                            &#X2014;</FONT><FONT SIZE=1><EM>Gimli son of Gloin</EM></FONT><FONT SIZE=1>
</FONT></BLOCKQUOTE><P>One will often see C code in which a function is passed around 
together with its argument. Together they constitute a <I>fate</I>, a suspended computation which may be continued 
at any time by calling the function with its argument.</P><P>This arrangement is necessary in C because C functions are fixed 
at compile time, immutable at run time: The only way to express 
a pending computation is to specify the code and state separately.</P><P>Mythryl allows the two to be neatly combined:</P><PRE CLASS="verbatim">    #!/usr/bin/mythryl

    fun delayed_print  string
        =
        \\ () = printf "%s\n" string;

    fate_a =  delayed_print "Just";
    fate_b =  delayed_print "another";
    fate_c =  delayed_print "Mythryl";
    fate_d =  delayed_print "hacker!";

    fate_a ();
    fate_b ();
    fate_c ();
    fate_d ();
</PRE><P>When run this produces</P><PRE CLASS="verbatim">    linux$ ./my-script
    Just
    another
    Mythryl
    hacker!
    linux$ 
</PRE><P>What has happened here is that the anonymous functions (<I>thunk</I>)s constructed 
by the <CODE><TT>\\ () = printf "%s\n" string;</TT></CODE> line of code are <I>capturing</I> the 
<TT>string</TT> arguments visible to them.</P><P>The Mythryl <TT><BR>
</TT> statement is actually a <I>data constructor</I>!</P><P>In principle, if we really wanted to, we could write our programs 
constructing all of our datastructures entirely in terms of <TT><BR>
</TT> 
statements capturing value, although the resulting code would not be 
very pleasant to read. For example, we could constructs lists via 
a function which captures two values and returns a thunk capable of 
returning either on request. Here is a slightly simplified example 
of such a function:</P><PRE CLASS="verbatim">    #!/usr/bin/mythryl

    Selector = FIRST | SECOND;

    fun cons (a, b)
        =
        \\ selector = case selector
                      FIRST  =&gt; a;
                      SECOND =&gt; b;
                      esac;

    x = cons( "abc", "def" );

    printf "%s\n" (x FIRST);
    printf "%s\n" (x SECOND);
</PRE><P>When run, the above yields:</P><PRE CLASS="verbatim">    linux$ ./my-script
    abc
    def
    linux$ 
</PRE><P>Re-inventing the Mythryl list this way makes no sense, but using value 
capture to construct fates for later execution makes 
a lot of sense. You will see this pervasively in production Mythryl 
code that you read, and after using this technique for awhile you will 
wonder how you ever programmed without it.</P>

<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-Mythryl_Functions__List_Handling_Idioms.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-The_Full_Monte.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-Mythryl_Functions__Currying_and_Partial_Application.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
