<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>_Core</TITLE>
</HEAD>
<BODY >
<A HREF="my-Compiler_Packages.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-anormcode_form.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc603">13.5.1</A>  _Core</H3><P>						<A NAME="@pkg266"></A>
<A NAME="pkg:_Core"></A>
The <TT>_Core</TT> package is deepest, blackest magic. It is directly relevant 
only to maintainers working at the heart of the Mythryl system.</P><P>Bootstrapping a software system like the Mythryl compiler is quite 
tricky. There are a number of facilities which each seem to need to be 
defined before the others. For example, the symbol tables must exist in order 
to do any compiling at all, but the compiler must be operating 
in order to compile the symbol table source.</P><P>Working around these problems generally involves weird ad hoc 
hacks, and the earlier in the bootstrap process, the weirder 
and more ad hoc the hacks get.</P><P>The <TT>_Core</TT> package is the earliest and weirdest of them all; 
it is defined before anything else, and contains a grabbag of 
the functions, types 
and values absolutely most critical to bootstrapping the rest of 
the system, together with those requiring the most ad hoc of hacks.</P><P>The <TT>_Core</TT> package name is deliberately not legal surface 
syntax, to reduce the temptation to use this package for anything 
but its intended very early bootstrapping purposes.</P><P>The <TT>assembly</TT> sub-package provides a gateway to those functions 
actually implemented in assembly language, rather than C or Mythryl. 
Since there is actually no Mythryl source code at all for these functions, 
making this code look like a vanilla Mythryl package to the rest 
of the system requires some very special-case processing.</P><P>The <TT>tdp_*</TT> functions and values provide hooks for Timing, 
Debugging and Profiling functionality, which are implemented via 
low-level backdoors into code generation.</P><P>The exceptions defined are those needed at low internal levels 
within the system, which thus need to be available very early 
in bootstrapping.</P><P>The most relevant sourcefile is 
<A HREF="my-src_lib_core_init_core_pkg.html#src/lib/core/init/core.pkg">src/lib/core/init/core.pkg</A>.</P><P>Also relevant are <A HREF="my-src_app_makelib_compile_core-hack_pkg.html#src/app/makelib/compile/core-hack.pkg">src/app/makelib/compile/core-hack.pkg</A> and <A HREF="my-src_lib_compiler_front_typer-stuff_basics_core-symbol_pkg.html#src/lib/compiler/front/typer-stuff/basics/core-symbol.pkg">src/lib/compiler/front/typer-stuff/basics/core-symbol.pkg</A>.<FONT SIZE=1><I>The above information is manually maintained and may contain errors.</I></FONT>
</P><PRE CLASS="verbatim">api {
    assign : (Ref(X ) , X) -&gt; Void;
    delay : (Void -&gt; X) -&gt; Suspension(X );
    deref : Ref(X ) -&gt; X;
    fin_to_inf : (?.Int1 , Bool) -&gt; ?.core_multiword_int::Multiword_Int;
    force : Suspension(X ) -&gt; X;
    get : (Rw_Vector(X ) , Int) -&gt; X;
    iadd : (Int , Int) -&gt; Int;
    inf_low_value : ?.core_multiword_int::Multiword_Int -&gt; Int;
    make_float_vector : (Int , Float) -&gt; Rw_Vector(Float );
    make_neg_inf : List(?.word ) -&gt; ?.core_multiword_int::Multiword_Int;
    make_pos_inf : List(?.word ) -&gt; ?.core_multiword_int::Multiword_Int;
    make_small_neg_inf : ?.word -&gt; ?.core_multiword_int::Multiword_Int;
    make_small_pos_inf : ?.word -&gt; ?.core_multiword_int::Multiword_Int;
    make_vector : (Int , X) -&gt; Rw_Vector(X );
    maximum_vector_length : Int;
    poly_equal : (X , X) -&gt; Bool;
    register_package_for_time_profiling : Ref((String -&gt; (Int , Rw_Vector(Int ) , Ref(Int ))) );
    space_profiling_register : Ref(((runtime::Chunk , String) -&gt; runtime::Chunk) );
    string_equal : (String , String) -&gt; Bool;
    tdp_active_plugins : Ref(List(Tdp_Plugin ) );
    tdp_enter : Void -&gt; (Int , Int) -&gt; Void;
    tdp_idk_entry_point : Int;
    tdp_idk_non_tail_call : Int;
    tdp_idk_tail_call : Int;
    tdp_nopush : Void -&gt; (Int , Int) -&gt; Void;
    tdp_push : Void -&gt; (Int , Int) -&gt; Void -&gt; Void;
    tdp_register : Void -&gt; (Int , Int , Int , String) -&gt; Void;
    tdp_reserve : Int -&gt; Int;
    tdp_reset : Void -&gt; Void;
    tdp_save : Void -&gt; Void -&gt; Void -&gt; Void;
    test_inf : ?.core_multiword_int::Multiword_Int -&gt; ?.Int1;
    trunc_inf : ?.core_multiword_int::Multiword_Int -&gt; ?.Int1;
    unboxed_set : (Rw_Vector(X ) , Int , X) -&gt; Void;
    zero_length_vector__global : ?.Vector(X );
    exception BIND;
    exception INDEX_OUT_OF_BOUNDS;
    exception MATCH;
    exception RANGE;
    exception SIZE;
    Suspension X;
          Tdp_Plugin  =         {enter:(Int , Int) -&gt; Void, name:String, nopush:(Int , Int) -&gt; Void,
                                push:(Int , Int) -&gt; Void -&gt; Void, register:(Int , Int , Int , String) -&gt; Void,
                                save:Void -&gt; Void -&gt; Void};
        package runtime
          : api {
                Chunk;
                Null_Or X = NULL | THE X;
                    package asm
                      : api {
                            Cfunction  = Cfunction;
                            Unt8_Rw_Vector  = Unt8_Rw_Vector;
                            Float64_Rw_Vector  = Float64_Rw_Vector;
                            Spin_Lock  = Spin_Lock;
                            make_typeagnostic_rw_vector : (Int , X) -&gt; Rw_Vector(X );
                            find_cfun : (String , String) -&gt; Cfunction;
                            call_cfun : (Cfunction , X) -&gt; Y;
                            make_unt8_rw_vector : Int -&gt; Unt8_Rw_Vector;
                            make_float64_rw_vector : Int -&gt; Float64_Rw_Vector;
                            make_string : Int -&gt; String;
                            make_typeagnostic_ro_vector : (Int , List(X )) -&gt; ?.Vector(X );
                            floor : Float -&gt; Int;
                            logb : Float -&gt; Int;
                            scalb : (Float , Int) -&gt; Float;
                            try_lock : Spin_Lock -&gt; Bool;
                            unlock : Spin_Lock -&gt; Void;};;
                exception DIVIDE_BY_ZERO;
                exception OVERFLOW;
                exception RUNTIME_EXCEPTION (String , Null_Or(Int ));
                this_fn_profiling_hook_refcell__global : Ref(Int );
                software_generated_periodic_events_switch_refcell__global : Ref(Bool );
                software_generated_periodic_event_interval_refcell__global : Ref(Int );
                software_generated_periodic_event_handler_refcell__global : Ref((?.Fate(Void ) -&gt; ?.Fate(Void )) );
                microthread_switch_lock_refcell__global : Ref(Int );
                pervasive_package_pickle_list__global : Ref(Chunk );
                    posix_interprocess_signal_handler_refcell__global :
                    Ref(((Int , Int , ?.Fate(Void )) -&gt; ?.Fate(Void )) );
                zero_length_vector__global : ?.Vector(X );};;};
</PRE>

<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-Compiler_Packages.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-anormcode_form.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
