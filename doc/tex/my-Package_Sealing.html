<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>Package Sealing</TITLE>
</HEAD>
<BODY >
<A HREF="my-Api_Syntax.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Packages_and_APIs.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-Subpackages.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc289">10.11.4</A>  Package Sealing</H3><P>
<A NAME="section:ref:package-sealing"></A></P><P>The main use of an API is to <I>seal</I> a package, 
restricting the set of externally visible package 
elements to just those listed in the API. This 
allows us to impose implementation hiding by 
protecting package-internal types, values and 
functions from external view.</P><P>Here is an example:</P><PRE CLASS="verbatim">    api Counter {

        Counter;

        make_counter:      Void -&gt; Counter;
        increment_counter: Counter -&gt; Void;
        decrement_counter: Counter -&gt; Void;
        counter_value:     Counter -&gt; Int; 
    };

    package counter: Counter {

        Counter = COUNTER { count: Ref(Int), calls: Ref(Int) };

        fun make_counter () =  COUNTER { count =&gt; REF 0, calls =&gt; REF 0 };

        fun increment_counter (COUNTER { count, calls })
            =
            {   count := *count + 1;
                calls := *calls + 1;
            };

        fun decrement_counter (COUNTER { count, calls })
            =
            {   count := *count - 1;
                calls := *calls + 1;
            };

        fun counter_value (COUNTER { count, calls })
            =
            *count;
    };

</PRE><P>Here we are keeping both a counter value and also a count 
of calls made, perhaps for debugging purposes, but our 
API declares type <TT>Count</TT> to be abstract, hiding its 
internal structure from external view, so if we later decide 
to remove the <TT>calls</TT> field, we can be assured that we 
will not break any external code in other packages by so 
doing.</P>

<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-Api_Syntax.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Packages_and_APIs.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-Subpackages.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
