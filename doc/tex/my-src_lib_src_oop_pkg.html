<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>src/lib/src/oop.pkg</TITLE>
</HEAD>
<BODY >
<A HREF="my-src_lib_src_object2_pkg.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Codebase__pkg_Files.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-src_lib_src_overloaded-vector-and-matrix-ops-unit-test_pkg.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc2847">15.4.959</A>  src/lib/src/oop.pkg</H3><P>
<A NAME="src/lib/src/oop.pkg"></A>
<CODE>##&nbsp;oop.pkg</CODE><BR><BR>
<CODE>#&nbsp;Compiled&nbsp;by:</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_std_standard_lib.html#src/lib/std/standard.lib"><TT>src/lib/std/standard.lib</TT></A><BR><BR><CODE>package&nbsp;oop:&nbsp;Oop&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Oop&nbsp;&nbsp;&nbsp;is&nbsp;from&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_src_oop_api.html#src/lib/src/oop.api"><TT>src/lib/src/oop.api</TT></A><BR><BR><CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;identity&nbsp;x&nbsp;=&nbsp;x;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;use&nbsp;this&nbsp;type&nbsp;and&nbsp;value&nbsp;to</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;represent&nbsp;the&nbsp;subclass&nbsp;state</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;of&nbsp;a&nbsp;class&nbsp;when&nbsp;there&nbsp;is&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;fact&nbsp;no&nbsp;subclass/substate:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;Oop_Null&nbsp;=&nbsp;OOP_NULL;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;These&nbsp;two&nbsp;are&nbsp;from&nbsp;Bernard&nbsp;Berthomieu's</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;"OOP&nbsp;Programming&nbsp;Styles&nbsp;in&nbsp;ML"&nbsp;Appendix&nbsp;2.1.1:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;idea&nbsp;here&nbsp;is&nbsp;that&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;four-deep</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;class&nbsp;hierarchy,&nbsp;instances&nbsp;of&nbsp;the&nbsp;leaf&nbsp;class</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;contain&nbsp;state&nbsp;declared&nbsp;by&nbsp;that&nbsp;class&nbsp;plus</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;state&nbsp;declared&nbsp;by&nbsp;all&nbsp;three&nbsp;ancestral&nbsp;classes,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;which&nbsp;we&nbsp;represent&nbsp;by&nbsp;nested&nbsp;tuples&nbsp;like&nbsp;so:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;(&nbsp;root_class_state,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;(&nbsp;next_class_state,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;next_class_state,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;leaf_class_state,&nbsp;oop::NULL&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;local&nbsp;state&nbsp;of&nbsp;each&nbsp;class&nbsp;consists&nbsp;of&nbsp;a</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(state,&nbsp;substate)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;pair&nbsp;where&nbsp;"state"&nbsp;is&nbsp;the&nbsp;local&nbsp;state&nbsp;for&nbsp;this</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;class&nbsp;and&nbsp;"substate"&nbsp;is&nbsp;the&nbsp;chain&nbsp;of&nbsp;tuples</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;recording&nbsp;the&nbsp;state&nbsp;records&nbsp;of&nbsp;our&nbsp;subclasses,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;with&nbsp;the&nbsp;oop::NULL&nbsp;value&nbsp;being&nbsp;used&nbsp;essentially</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;as&nbsp;a&nbsp;NULL&nbsp;pointer&nbsp;to&nbsp;tie&nbsp;off&nbsp;the&nbsp;tuple-chain&nbsp;at</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;the&nbsp;leaf&nbsp;end.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Code&nbsp;from&nbsp;any&nbsp;particular&nbsp;class&nbsp;only&nbsp;directly&nbsp;manipulates</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;its&nbsp;local&nbsp;state,&nbsp;so&nbsp;we&nbsp;need&nbsp;a&nbsp;way&nbsp;to&nbsp;extract&nbsp;that&nbsp;local</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;state&nbsp;for&nbsp;manipulation&nbsp;and&nbsp;then&nbsp;later&nbsp;reconstruct&nbsp;the</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;complete&nbsp;nested-tuple&nbsp;sequence&nbsp;constituting&nbsp;the&nbsp;full</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;object&nbsp;state.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;do&nbsp;this&nbsp;via&nbsp;recursive&nbsp;calls,&nbsp;each&nbsp;class&nbsp;talking&nbsp;directly</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;only&nbsp;to&nbsp;its&nbsp;superclass.&nbsp;&nbsp;Each&nbsp;class&nbsp;exports&nbsp;an&nbsp;"unpack"</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;function&nbsp;for&nbsp;extracting&nbsp;the&nbsp;local&nbsp;state&nbsp;of&nbsp;its&nbsp;subclass</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;and&nbsp;a&nbsp;"repack"&nbsp;function&nbsp;for&nbsp;doing&nbsp;the&nbsp;reverse,&nbsp;folding</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;the&nbsp;possibly&nbsp;updated&nbsp;subclass&nbsp;local&nbsp;state&nbsp;back&nbsp;in.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;following&nbsp;two&nbsp;functions&nbsp;are&nbsp;convenience&nbsp;functions</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;used&nbsp;in&nbsp;implementing&nbsp;such&nbsp;unpack/repack&nbsp;functions.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;"repack"&nbsp;function&nbsp;updates&nbsp;our&nbsp;local&nbsp;state&nbsp;via&nbsp;a</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;provided&nbsp;"update_state"&nbsp;function&nbsp;and&nbsp;then&nbsp;recreates</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;the&nbsp;full&nbsp;object&nbsp;state&nbsp;tuple-chain&nbsp;via&nbsp;the&nbsp;"repack"</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;function:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;repack_object&nbsp;&nbsp;update_state&nbsp;&nbsp;(repack,&nbsp;(state,&nbsp;substate))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(repack&nbsp;(update_state&nbsp;state,&nbsp;substate));</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Our&nbsp;"unpack"&nbsp;function&nbsp;implements&nbsp;most&nbsp;of&nbsp;the&nbsp;functionality</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;needed&nbsp;by&nbsp;the&nbsp;class&nbsp;"unpack"&nbsp;functions.&nbsp;&nbsp;It&nbsp;extracts&nbsp;the&nbsp;subclass</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;state&nbsp;record&nbsp;"substate"&nbsp;while&nbsp;creating&nbsp;a&nbsp;repack&nbsp;function</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;which&nbsp;knows&nbsp;how&nbsp;to&nbsp;to&nbsp;recreate&nbsp;the&nbsp;object.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;return&nbsp;value&nbsp;includes&nbsp;both&nbsp;the&nbsp;recreation&nbsp;function</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;and&nbsp;the&nbsp;extracted&nbsp;"substate"&nbsp;record:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;unpack_object&nbsp;&nbsp;(repack,&nbsp;(state,&nbsp;substate))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;\\&nbsp;new_substate&nbsp;=&nbsp;repack&nbsp;(state,&nbsp;new_substate),&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Create&nbsp;'repack'&nbsp;fn&nbsp;for&nbsp;our&nbsp;subclass.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;substate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Always&nbsp;a&nbsp;(state',&nbsp;substate')&nbsp;pair.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;For&nbsp;the&nbsp;Phase&nbsp;II&nbsp;oop&nbsp;approach&nbsp;we're&nbsp;using&nbsp;REF&nbsp;cells</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;to&nbsp;distinguish&nbsp;objects&nbsp;of&nbsp;one&nbsp;class&nbsp;from&nbsp;another.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;REF&nbsp;cells&nbsp;are&nbsp;equal&nbsp;to&nbsp;themselves&nbsp;and&nbsp;unequal&nbsp;to&nbsp;all</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;other&nbsp;REF&nbsp;cells,&nbsp;so&nbsp;by&nbsp;marking&nbsp;all&nbsp;members&nbsp;of&nbsp;a&nbsp;given</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;class&nbsp;using&nbsp;the&nbsp;same&nbsp;REF&nbsp;cell&nbsp;we&nbsp;can&nbsp;make&nbsp;the&nbsp;required</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;distinction.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;never&nbsp;get&nbsp;or&nbsp;set&nbsp;the&nbsp;value&nbsp;of&nbsp;these</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;REF&nbsp;cells;&nbsp;we&nbsp;are&nbsp;only&nbsp;interested&nbsp;in&nbsp;the&nbsp;cells&nbsp;themselves,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;not&nbsp;their&nbsp;values.&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Here&nbsp;we&nbsp;establish&nbsp;a&nbsp;"null&nbsp;pointer"&nbsp;REF&nbsp;cell&nbsp;to&nbsp;put&nbsp;in</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;unused&nbsp;"my&nbsp;subclass&nbsp;is&nbsp;..."&nbsp;slots:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;no_subclass&nbsp;=&nbsp;REF&nbsp;0;</CODE><BR><BR>
<CODE>};</CODE><BR><BR>
</P>

<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-src_lib_src_object2_pkg.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Codebase__pkg_Files.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-src_lib_src_overloaded-vector-and-matrix-ops-unit-test_pkg.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
