<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>Run a long-lived Linux subprocess</TITLE>
</HEAD>
<BODY >
<A HREF="my-Process_contents_of_directories_and_directory_trees.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Recipes.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-Count_the_number_of_cores_available_on_host.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc172">5.5.57</A>  Run a long-lived Linux subprocess</H3><P>The easiest way to run a subprocess is to use 
<TT>bin_sh&#X2019;</TT>, but they are no help if you need to 
run a persistent subprocess to respond to multiple commands.</P><P>The easiest way to do that is to use the <TT>spawn</TT> package, 
which hides the messy details of <TT>fork</TT>ing and setting 
up pipes:
</P><PRE CLASS="verbatim">    #!/usr/bin/mythryl

    fun run_subprocess ()
        = 
        {
            (spawn__premicrothread::spawn ("/bin/sh", []))
                -&gt;
                { from_stream, to_stream, ... };                                        # spawn__premicrothread is from   src/lib/std/src/posix/spawn--premicrothread.pkg

            file::write (to_stream, "echo 'xyzzy'\n");                                  # file__premicrothread  is from   src/lib/std/src/posix/file--premicrothread.pkg
            file::flush to_stream;

            printf "Read from subprocess: '%s'\n" (string::chomp (the (file::read_line  from_stream) ) );

            exit 0;
        };

    run_subprocess ();

</PRE>

<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-Process_contents_of_directories_and_directory_trees.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Recipes.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-Count_the_number_of_cores_available_on_host.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
