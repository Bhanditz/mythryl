#!/usr/bin/perl -w
use strict;

# All packages visible at top level get an autogenerated
#
#     doc/tex/tmp-pkg-foo.tex
#
# file but it is pretty useless by itself;
# it needs a matching hand-made
#
#     doc/tex/bot-pkg-foo.tex
#
# containing commentary and examples.
#
# Here we enumerate packages lacking such annotations:

my $max_package_files_to_list = 25;


# Find all pkg definition files produced by sh/make-api-latex:
#
my @pkg_files = `ls -1 doc/tex/tmp-pkg*tex`;
my $pkg_files_count = scalar @pkg_files;


my %unannotated_pkgs = ();

# Grep each such file for a \input{... } including annotations:
#
for my $pkg_file (@pkg_files) {

    chomp $pkg_file;

    my @pkg_file_references
        =
        `egrep '\\input\{.*-pkg-.*\.tex\}' $pkg_file`;

    my $references = scalar @pkg_file_references;

    if ($references == 0) { ++ $unannotated_pkgs{ $pkg_file }; }
}

my $unannotated_pkg_count = scalar( keys %unannotated_pkgs );

if ($unannotated_pkg_count > 0) {
    print "$unannotated_pkg_count autogenerated package description files lack manual annotations:\n";
}

my $count = 0;
for my $pkg (sort keys %unannotated_pkgs) {
    print "    $pkg\n";
    if (++$count >= $max_package_files_to_list) {
	print "    ...\n";
        last;
    };
}

exit 0;
