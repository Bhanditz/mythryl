#!/bin/sh

# To make our API docs as reliable and up-to-date as
# possible, we generate them mechanically from the
# internal compiler symbol tables.
#
# Here we generate LaTeX-format API summaries,
# one   doc/tex/tmp-Foo.api   file per interface Foo.
#
# The appropriate doc/tex/chapter-api*.tex files then does
#     \input{doc/tex/tmp-Foo.api}
# to tie this into the main doc/tex/book.tex document,
# which gets converted into html when we do
#
#     make docs
#
# at the top level.


# Invoke our code in   latex-print-compiler-state.pkg
#
bin/mythryld <<EOF
    print "\n";
#    print compiler::version.system;
    print "\n";

    makelib::makelib_state::dump_latex
        {
          directory       =>  "doc/tex",
          filename_prefix =>  "tmp-",
          filename_suffix =>  ".tex"
        };
EOF



# La/TeX requires that all underlines be \'d.
# (Unless subscripting is actually intended!)
#
# Rather than scattering that job all through
# our compiler .pkg files, we just do a pass
# here implementing that requirement.  Perl
# is really the cat's pyjamas for this stuff:
#
# perl -pie.bak 's/_/\\_/g;' doc/tex/tmp-*.tex



# Remove the .bak files generated by the preceding:
#
# rm doc/tex/tmp-api-*.tex.bak



exit 0
