#!/usr/bin/perl -w
use strict;

# All apis visible at top level get an autogenerated
#
#     doc/tex/tmp-api-Foo.tex
#
# file but it is pretty useless by itself;
# it needs a matching hand-made
#
#     doc/tex/top-api-Foo.tex
#
# containing commentary and cross-references.
#
# Here we enumerate apis lacking such annotations:

my $max_api_files_to_list = 25;


# Find all api definition files produced by sh/make-api-latex:
#
my @api_files = `ls -1 doc/tex/tmp-api*tex`;
my $api_files_count = scalar @api_files;


my %unannotated_apis = ();

# Grep each such file for a \input{... } including annotations:
#
for my $api_file (@api_files) {

    chomp $api_file;

    my @api_file_references
        =
        `egrep '\\input\{.*-api-.*\.tex\}' $api_file`;

    my $references = scalar @api_file_references;

    if ($references == 0) { ++ $unannotated_apis{ $api_file }; }
}

my $unannotated_api_count = scalar( keys %unannotated_apis );

if ($unannotated_api_count > 0) {
    print "$unannotated_api_count autogenerated api description files lack manual annotations:\n";
}

my $count = 0;
for my $api (sort keys %unannotated_apis) {
    print "    $api\n";
    if (++$count >= $max_api_files_to_list) {
	print "    ...\n";
        last;
    };
}

exit 0;
