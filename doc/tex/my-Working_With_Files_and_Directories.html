<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>Working With Files and Directories</TITLE>
</HEAD>
<BODY >
<A HREF="my-Mythryl_foreach_Loops.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-The_Bare_Essentials.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-Commandline_Arguments.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc62">5.2.13</A>  Working With Files and Directories</H3><P>The easiest way to read a textfile is to use the <TT>file::as_lines</TT> 
library function, which returns the contents of the file as a list 
of lines:</P><PRE CLASS="verbatim">    #!/usr/bin/mythryl

    foreach (file::as_lines "my-script") {.
        print #line;
    };
</PRE><P>When run, this script prints itself out, unsurprisingly enough:</P><PRE CLASS="verbatim">    linux$ ./my-script
    #!/usr/bin/mythryl

    foreach (file::as_lines "my-script") {.
        print #line;
    };

    linux$
</PRE><P>Similarly, the easiest way to write a textfile is to use the 
<TT>file::from_lines</TT> library function:</P><PRE CLASS="verbatim">    #!/usr/bin/mythryl

    file::from_lines
        "foo.txt"
        [ "abc\n", "def\n", "ghi\n" ];
</PRE><P>Running this from the commandline creates a three-line 
file named <TT>foo.txt</TT>:</P><PRE CLASS="verbatim">    linux$ ./my-script
    linux$ cat foo.txt
    abc
    def
    ghi
    linux$
</PRE><P>The easiest way to modify a textfile is just to combine 
the above two operations. Suppose, for example, that like 
Will Strunk (of <I>The Elements of Style</I> fame), you 
detest the word &#X201C;utilize&#X201D; and believe replacing it with 
&#X201C;use&#X201D; is always an improvement.</P><P>Use your favorite text editor to create a file named <TT>foo.txt</TT> 
containing the following text:</P><PRE CLASS="verbatim">    Will Strunk never used "utilize";
    he always utilized "use".
</PRE><P>Here is a script which will change "utilize" to "use" 
throughout that file: </P><PRE CLASS="verbatim">    #!/usr/bin/mythryl

    fun fix_line( line ) = {
        regex::replace_all ./utilize/ "use" line;
    };

    lines = file::as_lines "foo.txt";

    lines = map fix_line lines;

    file::from_lines "foo.txt" lines;
</PRE><P>And here it is in action:</P><PRE CLASS="verbatim">    linux$ cat foo.txt
    Will Strunk never used "utilize";
    he always utilized "use".

    linux$ ./my-script
    linux$ cat foo.txt
    Will Strunk never used "use";
    he always used "use".

    linux$
</PRE><P>If you like one-liners, here is a one-line version of the above script:</P><PRE CLASS="verbatim">    #!/usr/bin/mythryl
    file::from_lines "foo.txt" (map (regex::replace_all ./utilize/ "use") (file::as_lines "foo.txt"));
</PRE><P>The easiest way to get the names of the files in the current 
directory is to use <TT>dir::files</TT>:</P><PRE CLASS="verbatim">    linux$ my

    eval:  foreach (dir::files ".") {. printf "%s\n" #filename; };
    my-script
    foo.txt

    eval:  ^D

    linux$
</PRE><P>The easiest way to get the names of all the files in the 
current directory or any directory under it is to replace 
<TT>dir::files</TT> by <BR>
dir_tree::files in the above script.</P>

<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-Mythryl_foreach_Loops.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-The_Bare_Essentials.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-Commandline_Arguments.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
