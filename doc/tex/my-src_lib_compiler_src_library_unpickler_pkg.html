<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<META name="GENERATOR" content="hevea 1.10">
<LINK REL=STYLESHEET type="text/css" HREF="local.css">
<LINK rel="stylesheet" type="text/css" href="book.css">
<TITLE>src/lib/compiler/src/library/unpickler.pkg</TITLE>
</HEAD>
<BODY >
<A HREF="my-src_lib_compiler_src_library_pickler_pkg.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Codebase__pkg_Files.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-src_lib_compiler_src_print_prettyprint-table_pkg.html"><IMG SRC="next_motif.gif" ALT="Next"></A><HR>
<H3 CLASS="subsection"><A NAME="htoc2573">15.4.685</A>  src/lib/compiler/src/library/unpickler.pkg</H3><P>
<A NAME="src/lib/compiler/src/library/unpickler.pkg"></A>
<CODE>#&nbsp;unpickler.pkg</CODE><BR><BR>
<CODE>#&nbsp;Compiled&nbsp;by:</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_compiler_src_library_pickle_lib.html#src/lib/compiler/src/library/pickle.lib"><TT>src/lib/compiler/src/library/pickle.lib</TT></A><BR><BR><BR><BR><CODE>#&nbsp;This&nbsp;is&nbsp;the&nbsp;new&nbsp;"generic"&nbsp;unpickle&nbsp;facility.</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;It&nbsp;replaces&nbsp;Andrew&nbsp;Appel's&nbsp;original&nbsp;"shareread"&nbsp;module.</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;The&nbsp;main&nbsp;difference&nbsp;is&nbsp;that&nbsp;instead&nbsp;of&nbsp;using&nbsp;a&nbsp;"universal"</CODE><BR>
<CODE>#&nbsp;type&nbsp;together&nbsp;with&nbsp;numerous&nbsp;injections&nbsp;and&nbsp;projections</CODE><BR>
<CODE>#&nbsp;it&nbsp;uses&nbsp;separate&nbsp;maps.</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;This&nbsp;approach&nbsp;proves&nbsp;to&nbsp;be&nbsp;a&nbsp;lot&nbsp;more&nbsp;lightweight.</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;The&nbsp;benefits&nbsp;are:</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;-&nbsp;No&nbsp;projections,&nbsp;hence&nbsp;no&nbsp;"match&nbsp;nonexhaustive"&nbsp;warnings&nbsp;and...</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;-&nbsp;No&nbsp;additional&nbsp;run-time&nbsp;overhead&nbsp;(all&nbsp;checking&nbsp;is&nbsp;done&nbsp;during</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;map&nbsp;membership&nbsp;test&nbsp;which&nbsp;is&nbsp;common&nbsp;to&nbsp;both&nbsp;implementations)</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;-&nbsp;No&nbsp;necessity&nbsp;for&nbsp;those&nbsp;many&nbsp;tiny&nbsp;"fn"-functions&nbsp;that&nbsp;litter&nbsp;the</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;original&nbsp;code,&nbsp;resulting&nbsp;in...</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;-&nbsp;A&nbsp;more&nbsp;"natural"&nbsp;style&nbsp;for&nbsp;writing&nbsp;the&nbsp;actual&nbsp;unpickling&nbsp;code</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;makes&nbsp;for&nbsp;shorter&nbsp;source&nbsp;code</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;-&nbsp;A&nbsp;lot&nbsp;less&nbsp;generated&nbsp;machine&nbsp;code&nbsp;(less&nbsp;than&nbsp;50%&nbsp;of&nbsp;the&nbsp;original</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;version)</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;-&nbsp;Slightly&nbsp;faster&nbsp;operation&nbsp;(around&nbsp;15%&nbsp;speedup)</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(My&nbsp;guess&nbsp;is&nbsp;that&nbsp;it&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;fewer&nbsp;projections&nbsp;and</CODE><BR>
<CODE>#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fewer&nbsp;generated&nbsp;thunks&nbsp;that&nbsp;make&nbsp;the&nbsp;code&nbsp;run&nbsp;faster.)</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;July&nbsp;1999,&nbsp;Matthias&nbsp;Blume</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;We&nbsp;now&nbsp;use&nbsp;the&nbsp;high&nbsp;bit&nbsp;in&nbsp;char&nbsp;codes&nbsp;of&nbsp;shareable&nbsp;nodes&nbsp;to&nbsp;indicate</CODE><BR>
<CODE>#&nbsp;that&nbsp;actual&nbsp;sharing&nbsp;has&nbsp;occurred.&nbsp;&nbsp;If&nbsp;the&nbsp;high&nbsp;bit&nbsp;is&nbsp;not&nbsp;set,&nbsp;we</CODE><BR>
<CODE>#&nbsp;no&nbsp;longer&nbsp;bother&nbsp;to&nbsp;insert&nbsp;the&nbsp;node&nbsp;into&nbsp;its&nbsp;sharing&nbsp;map.&nbsp;&nbsp;This</CODE><BR>
<CODE>#&nbsp;improves&nbsp;unpickling&nbsp;speed&nbsp;(e.g.,&nbsp;for&nbsp;autoloading)&nbsp;by&nbsp;about&nbsp;25%&nbsp;and</CODE><BR>
<CODE>#&nbsp;saves&nbsp;tons&nbsp;of&nbsp;memory.</CODE><BR>
<CODE>#</CODE><BR>
<CODE>#&nbsp;October&nbsp;2000,&nbsp;Matthias&nbsp;Blume</CODE><BR><BR><BR><BR>
<CODE>###&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"If&nbsp;we&nbsp;wish&nbsp;to&nbsp;count&nbsp;lines&nbsp;of&nbsp;code,</CODE><BR>
<CODE>###&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;should&nbsp;not&nbsp;regard&nbsp;them&nbsp;as&nbsp;lines</CODE><BR>
<CODE>###&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*produced*&nbsp;but&nbsp;as&nbsp;lines&nbsp;*spent*."</CODE><BR>
<CODE>###</CODE><BR>
<CODE>###&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&nbsp;Edsger&nbsp;J&nbsp;Dijkstra</CODE><BR><BR><BR><BR><BR>
<CODE>api&nbsp;Unpickler&nbsp;{</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;exception&nbsp;FORMAT;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;Sharemap(V);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;One&nbsp;for&nbsp;each&nbsp;type.&nbsp;THIS&nbsp;IS&nbsp;MUTABLE&nbsp;STATE!</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;Unpickler;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Encapsulates&nbsp;unpickling&nbsp;state.</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Make&nbsp;a&nbsp;type-specific&nbsp;sharing&nbsp;map&nbsp;using&nbsp;"make_map".</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Be&nbsp;sure&nbsp;to&nbsp;create&nbsp;such&nbsp;maps&nbsp;only&nbsp;locally,&nbsp;otherwise&nbsp;you&nbsp;have&nbsp;a</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;space&nbsp;leak.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;Mythryl&nbsp;type&nbsp;system&nbsp;will&nbsp;prevent&nbsp;you&nbsp;from&nbsp;accidentially&nbsp;using&nbsp;the</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;same&nbsp;map&nbsp;for&nbsp;different&nbsp;types,&nbsp;so&nbsp;don't&nbsp;worry.&nbsp;&nbsp;But&nbsp;using&nbsp;TOO&nbsp;MANY</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;maps&nbsp;(i.e.,&nbsp;more&nbsp;than&nbsp;one&nbsp;map&nbsp;for&nbsp;the&nbsp;same&nbsp;type)&nbsp;will&nbsp;likely</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;cause&nbsp;problems&nbsp;because&nbsp;the&nbsp;unpickler&nbsp;might&nbsp;try&nbsp;to&nbsp;get&nbsp;for&nbsp;a</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;back&nbsp;reference&nbsp;that&nbsp;is&nbsp;in&nbsp;a&nbsp;different&nbsp;map&nbsp;than&nbsp;the&nbsp;one&nbsp;where&nbsp;the</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;value&nbsp;is&nbsp;actually&nbsp;registered.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;By&nbsp;the&nbsp;way,&nbsp;this&nbsp;warning&nbsp;is&nbsp;not&nbsp;unique&nbsp;to&nbsp;the&nbsp;many-maps&nbsp;approach.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;same&nbsp;thing&nbsp;would&nbsp;happen&nbsp;with&nbsp;the&nbsp;original&nbsp;"universal&nbsp;domain"</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;unpickler&nbsp;if&nbsp;you&nbsp;declare&nbsp;two&nbsp;different&nbsp;constructors&nbsp;for&nbsp;the</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;same&nbsp;type.&nbsp;&nbsp;Given&nbsp;that&nbsp;there&nbsp;are&nbsp;about&nbsp;100&nbsp;types&nbsp;(and&nbsp;thus</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;100&nbsp;constructors&nbsp;or&nbsp;maps)&nbsp;in&nbsp;the&nbsp;Mythryl&nbsp;dictionary&nbsp;pickler,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;the&nbsp;possibility&nbsp;for&nbsp;such&nbsp;a&nbsp;mistake&nbsp;is&nbsp;not&nbsp;to&nbsp;be&nbsp;dismissed.</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;make_sharemap:&nbsp;&nbsp;Void&nbsp;-&gt;&nbsp;Sharemap(V);</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;Pickle_Reader(V)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Void&nbsp;-&gt;&nbsp;V;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;A&nbsp;"charstream"&nbsp;is&nbsp;the&nbsp;mechanism&nbsp;that&nbsp;gets&nbsp;actual&nbsp;characters&nbsp;from</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;the&nbsp;pickle.&nbsp;&nbsp;For&nbsp;ordinary&nbsp;pickles,&nbsp;the&nbsp;unpickler&nbsp;will&nbsp;never&nbsp;call</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;"seek".&nbsp;&nbsp;Moreover,&nbsp;the&nbsp;same&nbsp;is&nbsp;true&nbsp;if&nbsp;you&nbsp;read&nbsp;the&nbsp;pickles&nbsp;created</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;by&nbsp;pickleN&nbsp;sequentially&nbsp;from&nbsp;the&nbsp;first&nbsp;to&nbsp;the&nbsp;last&nbsp;(i.e.,&nbsp;not</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;"out-of-order").&nbsp;"currentPosition"&nbsp;determines&nbsp;the&nbsp;current&nbsp;position</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;and&nbsp;must&nbsp;be&nbsp;implemented.</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;Charstream</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;getchar:&nbsp;&nbsp;&nbsp;Void&nbsp;-&gt;&nbsp;Char,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Read&nbsp;and&nbsp;return&nbsp;next&nbsp;char,&nbsp;advancing&nbsp;charstream&nbsp;cursor.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;peekchar:&nbsp;&nbsp;Int&nbsp;&nbsp;-&gt;&nbsp;Char,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Read&nbsp;ith-next&nbsp;char,&nbsp;leaving&nbsp;charstream&nbsp;cursor&nbsp;unchanged.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seek:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Int&nbsp;&nbsp;-&gt;&nbsp;Void,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Set&nbsp;charstream&nbsp;cursor&nbsp;to&nbsp;given&nbsp;value.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tell:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Void&nbsp;-&gt;&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Return&nbsp;charstream&nbsp;cursor.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Construct&nbsp;a&nbsp;Charstream&nbsp;which&nbsp;on&nbsp;successive&nbsp;calls</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;returns&nbsp;successive&nbsp;chars&nbsp;from&nbsp;given&nbsp;string:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;make_charstream_for_string</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;-&gt;&nbsp;Charstream;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;The&nbsp;string&nbsp;is&nbsp;the&nbsp;pickle&nbsp;string.&nbsp;</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;make_enhanced_charstream_for_string&nbsp;&nbsp;is&nbsp;a&nbsp;souped-up&nbsp;version&nbsp;of&nbsp;make_charstream_for_string:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;It&nbsp;takes&nbsp;a&nbsp;function&nbsp;to&nbsp;produce&nbsp;(and&nbsp;re-produce)&nbsp;the&nbsp;pickle&nbsp;string</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;on&nbsp;demand&nbsp;and&nbsp;returns&nbsp;the&nbsp;actual&nbsp;charstream&nbsp;together&nbsp;with&nbsp;a</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;"deleter"&nbsp;--&nbsp;a&nbsp;function&nbsp;to&nbsp;let&nbsp;go&nbsp;of&nbsp;the&nbsp;pickle&nbsp;string.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;When&nbsp;suspended&nbsp;unpickling&nbsp;resumes&nbsp;after&nbsp;the&nbsp;string&nbsp;got&nbsp;deleted,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;the&nbsp;charstream&nbsp;will&nbsp;automatically&nbsp;re-fetch&nbsp;the&nbsp;pickle&nbsp;string</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;using&nbsp;the&nbsp;function&nbsp;provided:</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;make_enhanced_charstream_for_string</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;Null_Or(&nbsp;String&nbsp;),</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Void&nbsp;-&gt;&nbsp;String)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;charstream:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Charstream,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clear_pickle_cache:&nbsp;&nbsp;Void&nbsp;-&gt;&nbsp;Void</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Open&nbsp;the&nbsp;unpickling&nbsp;session&nbsp;-&nbsp;everything&nbsp;is&nbsp;parameterized&nbsp;by&nbsp;this;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;the&nbsp;charstream&nbsp;provides&nbsp;the&nbsp;bytes&nbsp;of&nbsp;the&nbsp;pickle:</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;make_unpickler</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Charstream&nbsp;-&gt;&nbsp;Unpickler;</CODE><BR><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;typical&nbsp;style&nbsp;is&nbsp;to&nbsp;write&nbsp;a&nbsp;"read_&lt;my_type&gt;"&nbsp;function&nbsp;for&nbsp;each&nbsp;type.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;read&nbsp;function&nbsp;uses&nbsp;a&nbsp;local&nbsp;read_value_of_my_type&nbsp;function&nbsp;which&nbsp;takes&nbsp;the</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;first&nbsp;character&nbsp;of&nbsp;a&nbsp;pickle&nbsp;(this&nbsp;is&nbsp;usually&nbsp;the&nbsp;discriminator&nbsp;that</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;was&nbsp;given&nbsp;to&nbsp;@@@&nbsp;or&nbsp;%&nbsp;in&nbsp;the&nbsp;pickler)&nbsp;and&nbsp;returns&nbsp;the&nbsp;unpickled</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;value.&nbsp;&nbsp;The&nbsp;function&nbsp;recursively&nbsp;calls&nbsp;other&nbsp;"reader"&nbsp;functions.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;To&nbsp;actually&nbsp;get&nbsp;the&nbsp;value&nbsp;from&nbsp;the&nbsp;pickle,&nbsp;pass&nbsp;the&nbsp;read_value_of_my_type</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;to&nbsp;'read_sharable_value'&nbsp;--&nbsp;together&nbsp;with&nbsp;the&nbsp;current&nbsp;unpickler&nbsp;and&nbsp;the</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;type-appropriate&nbsp;sharemap.&nbsp;&nbsp;'read_sharable_value'&nbsp;will&nbsp;take&nbsp;care&nbsp;of</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;back-references&nbsp;(using&nbsp;the&nbsp;sharemap)&nbsp;and&nbsp;pass&nbsp;the&nbsp;first&nbsp;character&nbsp;to&nbsp;your&nbsp;read_value_of_my_type</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;when&nbsp;necessary.&nbsp;&nbsp;The&nbsp;standard&nbsp;pattern&nbsp;for&nbsp;writing&nbsp;a&nbsp;"read_&lt;my_type&gt;"</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;therefore&nbsp;is:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unpickler&nbsp;=&nbsp;unpickler::make_unpickler&nbsp;pickle</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_sharable_value&nbsp;&nbsp;&nbsp;sharemap&nbsp;&nbsp;&nbsp;read_value</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unpickler::read_sharable_value&nbsp;&nbsp;&nbsp;unpickler&nbsp;&nbsp;&nbsp;sharemap&nbsp;&nbsp;&nbsp;read_value</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;my_type&gt;_sharemap&nbsp;=&nbsp;unpickler::make_sharemap&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_&lt;my_type&gt;&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_sharable_value&nbsp;&nbsp;&nbsp;&lt;my_type&gt;_sharemap&nbsp;&nbsp;&nbsp;read_&lt;my_type&gt;'</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_&lt;my_type&gt;'&nbsp;'a'&nbsp;=&gt;&nbsp;...&nbsp;#&nbsp;&nbsp;Case&nbsp;a&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_&lt;my_type&gt;'&nbsp;'b'&nbsp;=&gt;&nbsp;...&nbsp;#&nbsp;&nbsp;Case&nbsp;b&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;=&gt;&nbsp;raise&nbsp;unpickler::FORMAT</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;read_sharable_value</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unpickler&nbsp;-&gt;&nbsp;Sharemap(V)&nbsp;-&gt;&nbsp;(Char&nbsp;-&gt;&nbsp;V)&nbsp;-&gt;&nbsp;V;</CODE><BR><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;If&nbsp;you&nbsp;know&nbsp;that&nbsp;you&nbsp;don't&nbsp;need&nbsp;a&nbsp;map&nbsp;because&nbsp;there&nbsp;can&nbsp;be&nbsp;no</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;sharing,&nbsp;then&nbsp;you&nbsp;can&nbsp;use&nbsp;"read_unsharable_value"&nbsp;instead&nbsp;of&nbsp;"read_sharable_value".</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;read_unsharable_value</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unpickler&nbsp;-&gt;&nbsp;(Char&nbsp;-&gt;&nbsp;V)&nbsp;-&gt;&nbsp;V;</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Making&nbsp;readers&nbsp;for&nbsp;some&nbsp;common&nbsp;types:&nbsp;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;read_int:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unpickler&nbsp;-&gt;&nbsp;Pickle_Reader(&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;read_int1:&nbsp;&nbsp;&nbsp;&nbsp;Unpickler&nbsp;-&gt;&nbsp;Pickle_Reader(&nbsp;one_word_int::Int&nbsp;&nbsp;);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;read_unt:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unpickler&nbsp;-&gt;&nbsp;Pickle_Reader(&nbsp;Unt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;read_unt1:&nbsp;&nbsp;&nbsp;&nbsp;Unpickler&nbsp;-&gt;&nbsp;Pickle_Reader(&nbsp;one_word_unt::Unt&nbsp;);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;read_bool:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unpickler&nbsp;-&gt;&nbsp;Pickle_Reader(&nbsp;Bool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;read_string:&nbsp;&nbsp;&nbsp;Unpickler&nbsp;-&gt;&nbsp;Pickle_Reader(&nbsp;String&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</CODE><BR><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Readers&nbsp;for&nbsp;parametric&nbsp;types&nbsp;need&nbsp;their&nbsp;own&nbsp;map:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;read_list:&nbsp;&nbsp;&nbsp;&nbsp;Unpickler&nbsp;-&gt;&nbsp;Sharemap(&nbsp;List(&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;)&nbsp;)&nbsp;&nbsp;-&gt;&nbsp;Pickle_Reader(V)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;Pickle_Reader(&nbsp;List(V)&nbsp;&nbsp;);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;read_null_or:&nbsp;Unpickler&nbsp;-&gt;&nbsp;Sharemap(&nbsp;Null_Or(V)&nbsp;)&nbsp;&nbsp;-&gt;&nbsp;Pickle_Reader(V)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;Pickle_Reader(&nbsp;Null_Or(V)&nbsp;);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;read_pair:&nbsp;&nbsp;&nbsp;&nbsp;Unpickler&nbsp;-&gt;&nbsp;Sharemap(&nbsp;(X,&nbsp;Y)&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;(Pickle_Reader(X),&nbsp;Pickle_Reader(Y))&nbsp;-&gt;&nbsp;Pickle_Reader(&nbsp;(X,&nbsp;Y)&nbsp;);</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;laziness&nbsp;generated&nbsp;here&nbsp;is&nbsp;in&nbsp;the&nbsp;unpickling.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;In&nbsp;other&nbsp;words&nbsp;unpickling&nbsp;state&nbsp;is&nbsp;not&nbsp;discarded</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;until&nbsp;the&nbsp;last&nbsp;lazy&nbsp;value&nbsp;has&nbsp;been&nbsp;forced.</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;read_lazy:&nbsp;&nbsp;&nbsp;&nbsp;Unpickler&nbsp;&nbsp;-&gt;&nbsp;&nbsp;Pickle_Reader(X)&nbsp;&nbsp;-&gt;&nbsp;&nbsp;Pickle_Reader(Void&nbsp;-&gt;&nbsp;X);</CODE><BR>
<CODE>};</CODE><BR><BR><BR><BR>
<CODE>stipulate</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;im&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;int_red_black_map;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;int_red_black_map&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;from&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_src_int-red-black-map_pkg.html#src/lib/src/int-red-black-map.pkg"><TT>src/lib/src/int-red-black-map.pkg</TT></A><BR><CODE>herein</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;&nbsp;&nbsp;unpickler</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unpickler&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Unpickler&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;from&nbsp;&nbsp;&nbsp;</CODE><A HREF="#src/lib/compiler/src/library/unpickler.pkg"><TT>src/lib/compiler/src/library/unpickler.pkg</TT></A><BR><CODE>&nbsp;&nbsp;&nbsp;&nbsp;{</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exception&nbsp;FORMAT;</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sharemap(V)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ref(&nbsp;im::Map(&nbsp;(V,&nbsp;Int)&nbsp;)&nbsp;);</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pickle_Reader(V)&nbsp;=&nbsp;&nbsp;&nbsp;Void&nbsp;-&gt;&nbsp;V;</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Charstream</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;getchar:&nbsp;&nbsp;Void&nbsp;-&gt;&nbsp;Char,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;peekchar:&nbsp;Int&nbsp;&nbsp;-&gt;&nbsp;Char,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seek:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Int&nbsp;&nbsp;-&gt;&nbsp;Void,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tell:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Void&nbsp;-&gt;&nbsp;Int</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Unpickler</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;string_sharemap:&nbsp;&nbsp;&nbsp;&nbsp;Sharemap(&nbsp;String&nbsp;),</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;charstream:&nbsp;Charstream</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;make_sharemap&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REF&nbsp;im::empty;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;make_charstream_for_string&nbsp;&nbsp;pickle_string</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Construct&nbsp;a&nbsp;Charstream&nbsp;which&nbsp;on&nbsp;successive&nbsp;calls</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;returns&nbsp;successive&nbsp;chars&nbsp;from&nbsp;given&nbsp;string:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;getchar,&nbsp;peekchar,&nbsp;seek,&nbsp;tell&nbsp;}</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;=&nbsp;REF&nbsp;0;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;getchar&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;old_position&nbsp;=&nbsp;&nbsp;*position;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;:=&nbsp;&nbsp;old_position&nbsp;+&nbsp;1;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string::get_byte_as_char&nbsp;(pickle_string,&nbsp;old_position)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INDEX_OUT_OF_BOUNDS&nbsp;=&nbsp;raise&nbsp;exception&nbsp;FORMAT;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;peekchar&nbsp;i</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string::get_byte_as_char&nbsp;(pickle_string,&nbsp;*position&nbsp;+&nbsp;i)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INDEX_OUT_OF_BOUNDS&nbsp;=&nbsp;raise&nbsp;exception&nbsp;FORMAT;</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;seek&nbsp;&nbsp;new_position</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;:=&nbsp;&nbsp;new_position;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;tell&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*position;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;make_enhanced_charstream_for_string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;fn&nbsp;is&nbsp;called&nbsp;(only)&nbsp;from:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_app_makelib_freezefile_freezefile-g_pkg.html#src/app/makelib/freezefile/freezefile-g.pkg"><TT>src/app/makelib/freezefile/freezefile-g.pkg</TT></A><BR><CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&nbsp;initial_pickle,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fetch_string</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;clear_pickle_cache,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;charstream&nbsp;=&gt;&nbsp;{&nbsp;getchar,&nbsp;peekchar,&nbsp;seek,&nbsp;tell&nbsp;}</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;=&nbsp;&nbsp;&nbsp;REF&nbsp;0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Tracks&nbsp;next&nbsp;char&nbsp;to&nbsp;read&nbsp;within&nbsp;initial_pickle.</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pickle_string_ref</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;REF&nbsp;&nbsp;initial_pickle;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;grab_string&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;*pickle_string_ref</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THE&nbsp;string&nbsp;=&gt;&nbsp;string;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;string&nbsp;=&nbsp;fetch_string&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pickle_string_ref&nbsp;:=&nbsp;THE&nbsp;string;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;esac;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;clear_pickle_cache&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pickle_string_ref&nbsp;:=&nbsp;NULL;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;getchar&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;&nbsp;grab_string&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;&nbsp;*position;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;:=&nbsp;&nbsp;p&nbsp;+&nbsp;1;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string::get_byte_as_char&nbsp;(s,&nbsp;p)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INDEX_OUT_OF_BOUNDS&nbsp;=&nbsp;&nbsp;raise&nbsp;exception&nbsp;FORMAT;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;peekchar&nbsp;i</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;&nbsp;grab_string&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p&nbsp;=&nbsp;&nbsp;*position;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string::get_byte_as_char&nbsp;(s,&nbsp;p+i)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;INDEX_OUT_OF_BOUNDS&nbsp;=&nbsp;&nbsp;raise&nbsp;exception&nbsp;FORMAT;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;seek&nbsp;&nbsp;new_position</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;:=&nbsp;&nbsp;new_position;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;tell&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*position;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;fun&nbsp;make_enhanced_charstream_for_string</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stipulate</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;from_any_int&nbsp;&nbsp;byte_source&nbsp;&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Read&nbsp;from&nbsp;byte_source&nbsp;an&nbsp;int&nbsp;encoded</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;in&nbsp;our&nbsp;indefinite-precision&nbsp;expanding-opcode</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;style&nbsp;bytestream&nbsp;encoding.&nbsp;&nbsp;The&nbsp;basic&nbsp;idea</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;here&nbsp;is:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;o&nbsp;The&nbsp;high&nbsp;bit&nbsp;is&nbsp;1&nbsp;on&nbsp;all&nbsp;bytes&nbsp;except&nbsp;the&nbsp;last.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;o&nbsp;On&nbsp;the&nbsp;last&nbsp;byte&nbsp;the&nbsp;second-highest&nbsp;bit&nbsp;gives&nbsp;the&nbsp;sign.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;o&nbsp;The&nbsp;remaining&nbsp;bits&nbsp;all&nbsp;get&nbsp;spliced&nbsp;together&nbsp;in&nbsp;sequence</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;generate&nbsp;the&nbsp;int&nbsp;result,&nbsp;last&nbsp;byte&nbsp;holding&nbsp;lowest&nbsp;bits.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loop&nbsp;0u0</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&nbsp;=&nbsp;&nbsp;one_byte_unt::bitwise_and;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;infix&nbsp;my&nbsp;&nbsp;&amp;&nbsp;;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to_large&nbsp;=&nbsp;one_byte_unt::to_large_unt;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;one_byte_unt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;from&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_std_one-byte-unt_pkg.html#src/lib/std/one-byte-unt.pkg"><TT>src/lib/std/one-byte-unt.pkg</TT></A><BR><CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;byte&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;from&nbsp;&nbsp;&nbsp;</CODE><A HREF="my-src_lib_std_src_byte_pkg.html#src/lib/std/src/byte.pkg"><TT>src/lib/std/src/byte.pkg</TT></A><BR><CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;loop&nbsp;n</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;w8&nbsp;=&nbsp;&nbsp;byte::char_to_byte&nbsp;(byte_source&nbsp;());</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((w8&nbsp;&amp;&nbsp;0u128)&nbsp;==&nbsp;0u0)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(n&nbsp;*&nbsp;(one_word_unt::from_int&nbsp;&nbsp;64)&nbsp;+&nbsp;to_large&nbsp;(w8&nbsp;&amp;&nbsp;0u63),&nbsp;(w8&nbsp;&amp;&nbsp;0u64)&nbsp;!=&nbsp;0u0);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loop&nbsp;(n&nbsp;*&nbsp;(one_word_unt::from_int&nbsp;128)&nbsp;+&nbsp;to_large&nbsp;(w8&nbsp;&amp;&nbsp;0u127));</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;from_large_unt&nbsp;&nbsp;convert&nbsp;&nbsp;byte_source&nbsp;&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;(from_any_int&nbsp;byte_source&nbsp;())</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(w,&nbsp;FALSE)&nbsp;=&gt;&nbsp;&nbsp;&nbsp;convert&nbsp;w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;_&nbsp;=&nbsp;raise&nbsp;exception&nbsp;FORMAT;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;&nbsp;raise&nbsp;exception&nbsp;FORMAT;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;esac;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;from_large_int&nbsp;&nbsp;convert&nbsp;&nbsp;byte_source&nbsp;&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;my&nbsp;(wpos,&nbsp;negative)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from_any_int&nbsp;&nbsp;byte_source&nbsp;&nbsp;();</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Negation&nbsp;must&nbsp;be&nbsp;done&nbsp;in&nbsp;unsigned&nbsp;domain</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;to&nbsp;prevent&nbsp;overflow&nbsp;on&nbsp;min_int.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;For&nbsp;the&nbsp;same&nbsp;reason&nbsp;we&nbsp;must</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;then&nbsp;use&nbsp;to_int_x.</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;negative&nbsp;&nbsp;&nbsp;??&nbsp;&nbsp;&nbsp;0u0&nbsp;-&nbsp;wpos</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::&nbsp;&nbsp;&nbsp;wpos;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;=&nbsp;&nbsp;large_unt::to_multiword_int_x&nbsp;&nbsp;w;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;convert&nbsp;i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;_&nbsp;=&nbsp;raise&nbsp;exception&nbsp;FORMAT;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;herein</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from_int&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;from_large_int&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int::from_multiword_int;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from_int1&nbsp;&nbsp;=&nbsp;&nbsp;from_large_int&nbsp;&nbsp;&nbsp;one_word_int::from_multiword_int;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from_unt&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;from_large_unt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unt::from_large_unt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from_unt1&nbsp;&nbsp;=&nbsp;&nbsp;from_large_unt&nbsp;&nbsp;&nbsp;one_word_unt::from_large_unt;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;make_unpickler&nbsp;&nbsp;charstream</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;string_sharemap&nbsp;=&gt;&nbsp;&nbsp;make_sharemap&nbsp;(),</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;charstream</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Unpickler;</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_sharable_value</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(unpickler:&nbsp;&nbsp;&nbsp;Unpickler)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shared_values_of_my_type</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_value_of_my_type</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;main&nbsp;duty&nbsp;of&nbsp;'read_sharable_value'&nbsp;is&nbsp;to&nbsp;factor</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;off&nbsp;from&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;unpickling&nbsp;code&nbsp;the&nbsp;job</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;of&nbsp;dealing&nbsp;with&nbsp;references&nbsp;to&nbsp;shared&nbsp;values</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;--&nbsp;values&nbsp;referenced&nbsp;by&nbsp;more&nbsp;than&nbsp;one&nbsp;pointer</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;in&nbsp;the&nbsp;pickled&nbsp;datastructure.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Such&nbsp;shared&nbsp;values&nbsp;are&nbsp;flagged&nbsp;in&nbsp;the&nbsp;pickle</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;bytestream&nbsp;by&nbsp;a&nbsp;0xFF&nbsp;byte&nbsp;(255&nbsp;decimal)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;followed&nbsp;by&nbsp;an&nbsp;integer&nbsp;backreference&nbsp;to&nbsp;the</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;offset&nbsp;in&nbsp;the&nbsp;pickle&nbsp;at&nbsp;which&nbsp;the&nbsp;actual</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;value&nbsp;may&nbsp;be&nbsp;found.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;first&nbsp;time&nbsp;we&nbsp;unpickle&nbsp;such&nbsp;a&nbsp;shared&nbsp;value,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;we&nbsp;salt&nbsp;it&nbsp;away&nbsp;in&nbsp;our&nbsp;shared_values_of_my_type.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;When&nbsp;we&nbsp;encounter&nbsp;subsequent&nbsp;backreferences&nbsp;to</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;that&nbsp;particular&nbsp;value,&nbsp;we&nbsp;can&nbsp;then&nbsp;just&nbsp;fish</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;the&nbsp;previously-unpickled&nbsp;value&nbsp;out&nbsp;of&nbsp;our</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;shared_values_of_my_type&nbsp;and&nbsp;return&nbsp;it,&nbsp;thus</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;re-establishing&nbsp;the&nbsp;desired&nbsp;value&nbsp;sharing.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;first_time&nbsp;(position,&nbsp;c)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Caller&nbsp;guarantees&nbsp;that&nbsp;character&nbsp;'c'</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;has&nbsp;the&nbsp;high&nbsp;bit&nbsp;set:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;v&nbsp;=&nbsp;&nbsp;read_value_of_my_type&nbsp;&nbsp;(char::from_int&nbsp;(char::to_int&nbsp;c&nbsp;-&nbsp;128));</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position'&nbsp;=&nbsp;&nbsp;&nbsp;unpickler.charstream.tell&nbsp;();</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shared_values_of_my_type</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;im::set&nbsp;(*shared_values_of_my_type,&nbsp;position,&nbsp;(v,&nbsp;position'));</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;&nbsp;unpickler.charstream.getchar&nbsp;();</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(char::to_int&nbsp;c&nbsp;&nbsp;&lt;&nbsp;&nbsp;128)</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;High-bit&nbsp;is&nbsp;not&nbsp;set,&nbsp;so&nbsp;this&nbsp;is&nbsp;not&nbsp;a&nbsp;shared&nbsp;node.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Therefore,&nbsp;it&nbsp;can't&nbsp;possibly&nbsp;be&nbsp;in&nbsp;the&nbsp;map,&nbsp;and</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;we&nbsp;can&nbsp;call&nbsp;read_value_of_my_type&nbsp;directly.</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_value_of_my_type&nbsp;c;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(c&nbsp;==&nbsp;'\xff')</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;=&nbsp;&nbsp;from_int&nbsp;&nbsp;unpickler.charstream.getchar&nbsp;&nbsp;();</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;(im::get&nbsp;&nbsp;(*shared_values_of_my_type,&nbsp;&nbsp;position))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THE&nbsp;(v,&nbsp;_)&nbsp;=&gt;&nbsp;v;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;here&nbsp;=&nbsp;&nbsp;unpickler.charstream.tell&nbsp;();</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unpickler.charstream.seek&nbsp;&nbsp;position;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;It&nbsp;is&nbsp;ok&nbsp;to&nbsp;use&nbsp;"getchar"&nbsp;here&nbsp;because</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;there&nbsp;won't&nbsp;be&nbsp;back-references&nbsp;that&nbsp;jump</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;to&nbsp;other&nbsp;back-references.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;(Since&nbsp;we&nbsp;are&nbsp;jumping&nbsp;to&nbsp;something&nbsp;that</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;was&nbsp;shared,&nbsp;it&nbsp;has&nbsp;the&nbsp;high-bit&nbsp;set,&nbsp;so</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;calling&nbsp;"firstTime"&nbsp;is&nbsp;ok.)</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first_time&nbsp;(position,&nbsp;unpickler.charstream.getchar())</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unpickler.charstream.seek&nbsp;&nbsp;here;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;esac;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;=&nbsp;&nbsp;unpickler.charstream.tell&nbsp;()&nbsp;-&nbsp;1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Must&nbsp;subtract&nbsp;one&nbsp;to&nbsp;get&nbsp;back&nbsp;in&nbsp;front&nbsp;of&nbsp;c.&nbsp;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;(im::get&nbsp;(*shared_values_of_my_type,&nbsp;position))</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THE&nbsp;(v,&nbsp;position')</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;unpickler.charstream.seek&nbsp;&nbsp;position';</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NULL&nbsp;=&gt;&nbsp;&nbsp;&nbsp;first_time&nbsp;(position,&nbsp;c);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;esac;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fi;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;"read_unsharable_value"&nbsp;gets&nbsp;around&nbsp;backref&nbsp;detection.&nbsp;&nbsp;Certain&nbsp;integer</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;encodings&nbsp;may&nbsp;otherwise&nbsp;be&nbsp;mis-identified&nbsp;as&nbsp;back&nbsp;references.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Moreover,&nbsp;unlike&nbsp;in&nbsp;the&nbsp;case&nbsp;of&nbsp;"read_sharable_value"&nbsp;we&nbsp;don't&nbsp;need&nbsp;a&nbsp;map</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;for&nbsp;"read_unsharable_value".&nbsp;&nbsp;This&nbsp;could&nbsp;be&nbsp;used&nbsp;as&nbsp;an&nbsp;optimization&nbsp;for</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;types&nbsp;that&nbsp;are&nbsp;known&nbsp;to&nbsp;never&nbsp;be&nbsp;shared&nbsp;anyway&nbsp;(Bool,&nbsp;etc.).</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_unsharable_value&nbsp;&nbsp;(unpickler:&nbsp;Unpickler)&nbsp;&nbsp;f</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f&nbsp;(unpickler.charstream.getchar&nbsp;());</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stipulate</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;f2r&nbsp;&nbsp;from_x&nbsp;&nbsp;(unpickler:&nbsp;Unpickler)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;"f2r"&nbsp;is&nbsp;probably&nbsp;"from_to_read"&nbsp;(converts&nbsp;a&nbsp;'from_x'&nbsp;fn&nbsp;to&nbsp;'read_x'&nbsp;fn).</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from_x&nbsp;&nbsp;unpickler.charstream.getchar;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;herein</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_int&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;f2r&nbsp;&nbsp;from_int;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_int1&nbsp;&nbsp;=&nbsp;&nbsp;f2r&nbsp;&nbsp;from_int1;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_unt&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;f2r&nbsp;&nbsp;from_unt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_unt1&nbsp;&nbsp;=&nbsp;&nbsp;f2r&nbsp;&nbsp;from_unt1;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;read_lazy&nbsp;advances&nbsp;'currentPosition'&nbsp;as&nbsp;though&nbsp;it</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;had&nbsp;read&nbsp;the&nbsp;next&nbsp;value,&nbsp;but&nbsp;does&nbsp;not&nbsp;actually</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;do&nbsp;so.&nbsp;&nbsp;Instead,&nbsp;it&nbsp;returns&nbsp;a&nbsp;memoized&nbsp;thunk</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;which&nbsp;will&nbsp;do&nbsp;so&nbsp;at&nbsp;need:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_lazy&nbsp;unpickler&nbsp;read_value_of_my_type&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;memo&nbsp;=&nbsp;&nbsp;&nbsp;REF&nbsp;&nbsp;(\\&nbsp;()&nbsp;=&nbsp;&nbsp;raise&nbsp;exception&nbsp;DIE&nbsp;"unpickler::readLazy");</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unpickler&nbsp;-&gt;&nbsp;&nbsp;&nbsp;{&nbsp;charstream&nbsp;=&gt;&nbsp;{&nbsp;tell,&nbsp;seek,&nbsp;...&nbsp;},&nbsp;...&nbsp;};</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;The&nbsp;size&nbsp;may&nbsp;have&nbsp;leading&nbsp;0s&nbsp;because&nbsp;of&nbsp;padding,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;so&nbsp;loop&nbsp;reading&nbsp;integers&nbsp;until&nbsp;we&nbsp;get&nbsp;a&nbsp;nonzero&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;value&nbsp;to&nbsp;return:</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;get_size&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;read_int&nbsp;unpickler&nbsp;();</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(size&nbsp;==&nbsp;0&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;&nbsp;get_size&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;&nbsp;size;&nbsp;&nbsp;&nbsp;&nbsp;fi;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Read&nbsp;size&nbsp;of&nbsp;value&nbsp;to</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;read&nbsp;lazily:</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;get_size&nbsp;();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;size&nbsp;of&nbsp;v&nbsp;</CODE><BR><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Remember&nbsp;position&nbsp;at&nbsp;which</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;lazily&nbsp;read&nbsp;value&nbsp;starts,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;so&nbsp;we&nbsp;can&nbsp;come&nbsp;back&nbsp;later</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;and&nbsp;actually&nbsp;read&nbsp;it:</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;=&nbsp;tell&nbsp;();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;start&nbsp;of&nbsp;v&nbsp;</CODE><BR><BR><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Construct&nbsp;a&nbsp;thunk&nbsp;to&nbsp;do&nbsp;the&nbsp;real</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;(lazily&nbsp;delayed)&nbsp;read&nbsp;of&nbsp;the</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;value,&nbsp;when&nbsp;it&nbsp;comes&nbsp;time&nbsp;to&nbsp;do&nbsp;so.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;To&nbsp;do&nbsp;this&nbsp;we&nbsp;need&nbsp;to&nbsp;'seek'&nbsp;back&nbsp;to</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;the&nbsp;proper&nbsp;position&nbsp;in&nbsp;the&nbsp;stream,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;but&nbsp;to&nbsp;maintain&nbsp;sanity&nbsp;(since&nbsp;this</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;will&nbsp;happen&nbsp;at&nbsp;an&nbsp;unpredictable</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;time)&nbsp;we&nbsp;write&nbsp;it&nbsp;to&nbsp;save&nbsp;and</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;restore&nbsp;the&nbsp;'tell'&nbsp;('current_position')&nbsp;value</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;in&nbsp;force&nbsp;at&nbsp;the&nbsp;time&nbsp;of&nbsp;thunk</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;invocation.</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;also&nbsp;memo-ize&nbsp;our&nbsp;thunk&nbsp;to&nbsp;cache</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;the&nbsp;value&nbsp;lazily&nbsp;read,&nbsp;so&nbsp;that&nbsp;on</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;second&nbsp;and&nbsp;subsequent&nbsp;thunk&nbsp;invocations,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;we&nbsp;can&nbsp;immediately&nbsp;return&nbsp;the&nbsp;cached</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;value&nbsp;rather&nbsp;than&nbsp;actually&nbsp;having&nbsp;to</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;do&nbsp;the&nbsp;complete&nbsp;read&nbsp;again.&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;thunk&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;initial_position&nbsp;=&nbsp;tell&nbsp;();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Remember&nbsp;prevailing&nbsp;stream&nbsp;position.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seek&nbsp;start;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Reset&nbsp;stream&nbsp;to&nbsp;start&nbsp;of&nbsp;our&nbsp;lazily-read&nbsp;value.&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v&nbsp;=&nbsp;read_value_of_my_type&nbsp;();&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Do&nbsp;the&nbsp;actual&nbsp;read&nbsp;of&nbsp;lazily-read&nbsp;value.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seek&nbsp;initial_position;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Restore&nbsp;prevailing&nbsp;stream&nbsp;position.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memo&nbsp;:=&nbsp;&nbsp;(\\&nbsp;()&nbsp;=&nbsp;&nbsp;v);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Set&nbsp;memo&nbsp;to&nbsp;return&nbsp;cached&nbsp;value&nbsp;instead&nbsp;of&nbsp;re-reading.&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Return&nbsp;lazily&nbsp;read&nbsp;value.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memo&nbsp;:=&nbsp;thunk;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Set&nbsp;up&nbsp;lazy&nbsp;read&nbsp;of&nbsp;value&nbsp;on&nbsp;initial&nbsp;thunk&nbsp;invocation.&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;seek&nbsp;(start&nbsp;+&nbsp;size);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Advance&nbsp;stream&nbsp;position&nbsp;if&nbsp;though&nbsp;we&nbsp;had&nbsp;read&nbsp;the&nbsp;value&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{.&nbsp;*memo&nbsp;();&nbsp;};&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;Return&nbsp;thunk&nbsp;that&nbsp;will&nbsp;do&nbsp;the&nbsp;lazy&nbsp;read&nbsp;on&nbsp;request.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_list&nbsp;&nbsp;unpickler&nbsp;&nbsp;sharemap_for_my_type&nbsp;&nbsp;read_value_of_my_type&nbsp;&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_sharable_value&nbsp;&nbsp;unpickler&nbsp;&nbsp;sharemap_for_my_type&nbsp;&nbsp;readlist</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_chops&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_sharable_value&nbsp;&nbsp;&nbsp;unpickler&nbsp;&nbsp;&nbsp;sharemap_for_my_type&nbsp;&nbsp;&nbsp;readchopslist</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;readchopslist&nbsp;'N'&nbsp;=&gt;&nbsp;[];</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readchopslist&nbsp;'C'&nbsp;=&gt;&nbsp;read_value_of_my_type&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;read_value_of_my_type&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;read_value_of_my_type&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;read_value_of_my_type&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;read_value_of_my_type&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!&nbsp;read_chops&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readchopslist&nbsp;_&nbsp;=&gt;&nbsp;raise&nbsp;exception&nbsp;FORMAT;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;readlist&nbsp;'0'&nbsp;=&gt;&nbsp;&nbsp;[];</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readlist&nbsp;'1'&nbsp;=&gt;&nbsp;&nbsp;[read_value_of_my_type&nbsp;()];</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readlist&nbsp;'2'&nbsp;=&gt;&nbsp;&nbsp;[read_value_of_my_type&nbsp;(),&nbsp;read_value_of_my_type&nbsp;()];</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readlist&nbsp;'3'&nbsp;=&gt;&nbsp;&nbsp;[read_value_of_my_type&nbsp;(),&nbsp;read_value_of_my_type&nbsp;(),&nbsp;read_value_of_my_type&nbsp;()];</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readlist&nbsp;'4'&nbsp;=&gt;&nbsp;&nbsp;[read_value_of_my_type&nbsp;(),&nbsp;read_value_of_my_type&nbsp;(),&nbsp;read_value_of_my_type&nbsp;(),&nbsp;read_value_of_my_type&nbsp;()];</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readlist&nbsp;'5'&nbsp;=&gt;&nbsp;&nbsp;read_chops&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readlist&nbsp;'6'&nbsp;=&gt;&nbsp;&nbsp;read_value_of_my_type&nbsp;()&nbsp;!&nbsp;read_chops&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readlist&nbsp;'7'&nbsp;=&gt;&nbsp;&nbsp;read_value_of_my_type&nbsp;()&nbsp;!&nbsp;read_value_of_my_type&nbsp;()&nbsp;!&nbsp;read_chops&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readlist&nbsp;'8'&nbsp;=&gt;&nbsp;&nbsp;read_value_of_my_type&nbsp;()&nbsp;!&nbsp;read_value_of_my_type&nbsp;()&nbsp;!&nbsp;read_value_of_my_type&nbsp;()&nbsp;!&nbsp;read_chops&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readlist&nbsp;'9'&nbsp;=&gt;&nbsp;&nbsp;read_value_of_my_type&nbsp;()&nbsp;!&nbsp;read_value_of_my_type&nbsp;()&nbsp;!&nbsp;read_value_of_my_type&nbsp;()&nbsp;!&nbsp;read_value_of_my_type&nbsp;()&nbsp;!&nbsp;read_chops&nbsp;();</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;readlist&nbsp;_&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;raise&nbsp;exception&nbsp;FORMAT;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_null_or&nbsp;&nbsp;unpickler&nbsp;&nbsp;sharemap_for_my_type&nbsp;&nbsp;read_value_of_my_type&nbsp;&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_sharable_value&nbsp;&nbsp;unpickler&nbsp;&nbsp;sharemap_for_my_type&nbsp;&nbsp;read_null_or'</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_null_or'&nbsp;'n'&nbsp;=&gt;&nbsp;&nbsp;NULL;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_null_or'&nbsp;'s'&nbsp;=&gt;&nbsp;&nbsp;THE&nbsp;(read_value_of_my_type&nbsp;());</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_null_or'&nbsp;_&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;raise&nbsp;exception&nbsp;FORMAT;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_pair&nbsp;&nbsp;unpickler&nbsp;&nbsp;sharemap_for_my_type&nbsp;&nbsp;(read_a,&nbsp;read_b)&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_sharable_value&nbsp;&nbsp;unpickler&nbsp;&nbsp;sharemap_for_my_type&nbsp;&nbsp;read_pair'</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_pair'&nbsp;'p'&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;&nbsp;(read_a&nbsp;(),&nbsp;read_b&nbsp;());</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_pair'&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;&nbsp;raise&nbsp;exception&nbsp;FORMAT;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_bool&nbsp;unpickler&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_unsharable_value&nbsp;&nbsp;unpickler&nbsp;&nbsp;read_bool'</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_bool'&nbsp;'t'&nbsp;=&gt;&nbsp;&nbsp;TRUE;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_bool'&nbsp;'f'&nbsp;=&gt;&nbsp;&nbsp;FALSE;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_bool'&nbsp;_&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;raise&nbsp;exception&nbsp;FORMAT;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_string&nbsp;&nbsp;unpickler&nbsp;&nbsp;()</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_sharable_value&nbsp;&nbsp;unpickler&nbsp;&nbsp;string_sharemap&nbsp;&nbsp;read_string'</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unpickler</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;string_sharemap,</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;charstream&nbsp;=&gt;&nbsp;&nbsp;{&nbsp;getchar,&nbsp;...&nbsp;}</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;read_string'&nbsp;'"'</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loop&nbsp;([],&nbsp;getchar&nbsp;())</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fun&nbsp;loop&nbsp;(l,&nbsp;'"')&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;&nbsp;string::implode&nbsp;(reverse&nbsp;l);</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loop&nbsp;(l,&nbsp;'\\')&nbsp;&nbsp;=&gt;&nbsp;&nbsp;&nbsp;loop&nbsp;(getchar&nbsp;()&nbsp;!&nbsp;l,&nbsp;getchar&nbsp;());</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loop&nbsp;(l,&nbsp;c)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;&nbsp;loop&nbsp;(c&nbsp;!&nbsp;l,&nbsp;getchar&nbsp;());</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;This&nbsp;is&nbsp;a&nbsp;bloody&nbsp;st00pid&nbsp;way&nbsp;to&nbsp;un/pickle&nbsp;strings!&nbsp;&nbsp;The&nbsp;'\'&nbsp;stuff&nbsp;is</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;fine&nbsp;for&nbsp;human-readable/human-editable&nbsp;sourcecode,&nbsp;but&nbsp;for&nbsp;mechanical</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;processing&nbsp;it&nbsp;is&nbsp;much&nbsp;better&nbsp;to&nbsp;just&nbsp;put&nbsp;a&nbsp;length&nbsp;up&nbsp;front&nbsp;and&nbsp;then</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;read&nbsp;that&nbsp;many&nbsp;bytes&nbsp;at&nbsp;one&nbsp;go.&nbsp;&nbsp;XXX&nbsp;BUGGO&nbsp;FIXME.&nbsp;&nbsp;--&nbsp;2011-01-18&nbsp;CrT</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_string'&nbsp;_</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raise&nbsp;exception&nbsp;FORMAT;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end;</CODE><BR>
<CODE>&nbsp;&nbsp;&nbsp;&nbsp;};</CODE><BR>
<CODE>end;</CODE><BR><BR>
</P>

<HR SIZE=2>
<DIV CLASS="center">
<FONT SIZE=1>Comments and suggestions to: </FONT><A HREF="mailto:bugs@mythryl.org"><FONT SIZE=1>bugs@mythryl.org</FONT></A></DIV>
<HR>
<A HREF="my-src_lib_compiler_src_library_pickler_pkg.html"><IMG SRC="previous_motif.gif" ALT="Previous"></A><A HREF="my-Codebase__pkg_Files.html"><IMG SRC="contents_motif.gif" ALT="Up"></A><A HREF="my-src_lib_compiler_src_print_prettyprint-table_pkg.html"><IMG SRC="next_motif.gif" ALT="Next"></A></BODY>
</HTML>
